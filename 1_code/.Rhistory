mutate(label = factor(label, levels = ess4_arrng)) %>%
ggplot(aes(label, total, fill = type, alpha = year)) +
geom_col(position = "dodge") +
scale_alpha_discrete(range = c(0.45, 1)) +
scale_y_continuous(labels = unit_format(unit = "", scale = 1e-6)) +
theme_Publication() +
scale_fill_Publication() +
theme(
axis.text.x = element_text(
angle = 90,
size = 10,
hjust = 1,
vjust = .4
),
axis.title.y = element_text(size = 11),
legend.position = "top"
) +
guides(alpha = "none") +
labs(
y = "Number of rural households (millions)",
x = "",
fill = "",
alpha = "",
title = "Number of rural households adopting each CGIAR-related innovation in Ethiopia, ESS -
change between 2018/19 (ESS4) and 2021/22 (ESS5)",
caption = "Note: Calculation based on logitudinal weights. For Chickpea Kabuli varieties, comparision is between 2015/16 (ESS3) and 2021/22 (ESS5)"
)
adopt_totals
adopt_totals %>% filter(label = "Forage grasses")
adopt_totals %>% filter(label == "Forage grasses")
adopt_totals %>% filter(label == "Forage grasses", sample == "panel")
# load data ----
wave5_hh <- read_dta("../3_report_data/wave5_hh_new.dta")
wave5_hh %>% select(contains("grass"))
wave5_hh %>% select(contains("grass")) %>% gli
wave5_hh %>% select(contains("grass")) %>% glimpse()
# ----- #
# Purpose: to create data on adoption rates of innovations only in wave 5
# Author: Lemi Daba (tayelemi@gmail.com)
# ----- #
# load data ----
wave5_hh <- read_dta("../3_report_data/wave5_hh_new.dta")
ess5_bounds <- read_dta("../tmp/adopt_reach/ess5_bounds.dta")
dna_means_hh <- read_csv("../tmp/dynamics/dna_means_hh.csv")
psnp_hh <- read_csv("../tmp/psnp/psnp_hh.csv")
recode_region <- function(tbl, region_var = region) {
suppressWarnings(
tbl %>%
mutate(
region = recode(
{{region_var}},
`1` = "Tigray",
`2` = "Afar",
`3` = "Amhara",
`4` = "Oromia",
`5` = "Somali",
`6` = "Benishangul Gumuz",
`7` = "SNNP",
`12` = "Gambela",
`13` = "Harar",
`15` = "Dire Dawa"
)
)
)
}
# some cleaning ----
innovs_w5 <- c(
# animal agriculture:
"hhd_livIA", "hhd_cross_largerum", "hhd_cross_smallrum", "hhd_cross_poultry",
# forages:
"hhd_agroind", "hhd_elepgrass", "hhd_deshograss", "hhd_sesbaniya", "hhd_sinar",
"hhd_lablab", "hhd_alfalfa", "hhd_vetch", "hhd_rhodesgrass", "hhd_grass",
"hhd_grassII",
# crop-germplasm improvment:
"maize_cg", "dtmz", "hhd_ofsp", "hhd_awassa83", "hhd_kabuli",
# Natural resoruce management:
"hhd_rdisp", "hhd_treadle", "hhd_motorpump", "hhd_swc", "hhd_consag1",
"hhd_consag2", "hhd_affor", "hhd_mango", "hhd_papaya", "hhd_avocado"
)
# ALL HOUSEHOLDS ----
hh_level_w5 <- wave5_hh %>%
select(
household_id, ea_id, wave, region = saq01, starts_with("pw_"), all_of(innovs_w5)
) %>%
recode_region()
# calculate means
mean_tbl <- function(tbl, vars, group_vars, pw) {
tbl %>%
pivot_longer(all_of(vars),
names_to = "variable",
values_to = "value") %>%
group_by(pick(group_vars)) %>%
summarise(
mean = weighted.mean(value, w = {{pw}}, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
)
}
means_hh_w5 <- bind_rows(
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5),
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable"), pw = pw_w5) %>%
mutate(region = "National")
) %>%
mutate(wave = paste("Wave", wave))
#
labs <- wave5_hh %>%
select(all_of(innovs_w5)) %>%
var_label() %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
) %>%
mutate(
label = str_replace(label, "Feed and Forage|Grass", "Forages"),
label = case_match(
variable,
"hhd_livIA" ~ "AI on any livestock type",
paste0("hhd_cross_", c("smallrum", "largerum", "poultry")) ~ str_to_title(label),
.default = label
)
)
# modify PSNP
psnp_w5_rur <- psnp_hh %>%
filter(
wave == "Wave 5", locality == "Rural",
sample == "All", region != "Addis Ababa"
) %>%
select(wave, variable, region, mean, nobs, label)
# create final tibble:
adopt_rates_w5_hh <- means_hh_w5  %>%
left_join(labs, by = "variable") %>%
select(wave, region, variable, label, mean, nobs) %>%
bind_rows(psnp_w5_rur)
adopt_rates_w5_hh
adopt_rates_w5_hh %>% filter(variable=="hhd_grassII")
adopt_rates_w5_hh %>% filter(variable=="hhd_grassII") %>% View()
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/1_code/10_3_adopt_reach_innovs_w5.R", echo=TRUE)
# ----- #
# Purpose: to create an Excel file with adoption reach estimates using hh weights
# Author: Lemi Daba (tayelemi@gmail.com)
# ----- #
# load data ----
track_hh <- read_dta("../tmp/dynamics/06_1_track_hh.dta")
adopt_rates_w4_hh <- read_csv("../tmp/adopt_reach/adopt_rates_w4_hh.csv")
adopt_rate_dna_w4 <- read_csv("../tmp/adopt_reach/adopt_rate_dna_w4.csv")
adopt_rates_w5_hh <- read_csv("../tmp/adopt_reach/adopt_rates_w5_hh.csv")
adopt_rate_dna_w5 <- read_csv("../tmp/adopt_reach/adopt_rate_dna_w5.csv")
bd_means_w4 <- read_csv("../tmp/adopt_reach/bd_means_w4.csv")
bd_mean_w5 <- read_csv("../tmp/adopt_reach/bd_mean_w5.csv")
# 1. calculate no. of rural & urban households by region for each wave
# Rural populations ----
pop_rur_w4_all <- track_hh %>%
filter(wave4==1, locality == "Rural") %>%
count(region, wt = pw_w4, name = "pop_w4_all") %>%
bind_rows(
data.frame(region = "National", pop_w4_all = sum(.$pop_w4_all))
)
pop_rur_w5_all <- track_hh %>%
filter(wave5==1, locality == "Rural") %>%
count(region, wt = pw_w5, name = "pop_w5_all") %>%
bind_rows(
data.frame(region = "National", pop_w5_all = sum(.$pop_w5_all))
)
pop_rur_pnl <- track_hh %>%
filter(locality == "Rural", hh_status==3) %>%
count(region, wt = pw_panel, name = "pop_w5_panel") %>%
bind_rows(
data.frame(region = "National", pop_w5_panel = sum(.$pop_w5_panel))
)
# Urban populations ----
pop_urb_w4_all <- track_hh %>%
filter(wave4==1, locality == "Urban") %>%
count(region, wt = pw_w4, name = "pop_w4_all") %>%
bind_rows(
data.frame(region = "National", pop_w4_all = sum(.$pop_w4_all))
)
pop_urb_w5_all <- track_hh %>%
filter(wave5==1, locality == "Urban") %>%
count(region, wt = pw_w5, name = "pop_w5_all") %>%
bind_rows(
data.frame(region = "National", pop_w5_all = sum(.$pop_w5_all))
)
pop_urb_pnl <- track_hh %>%
filter(locality == "Urban", hh_status==3) %>%
count(region, wt = pw_panel, name = "pop_w5_panel") %>%
bind_rows(
data.frame(region = "National", pop_w5_panel = sum(.$pop_w5_panel))
)
# Wave 4: cross-sectional weight
ess4_innov <- adopt_rates_w4_hh %>%
left_join(pop_rur_w4_all, by = "region") %>%
mutate(abs_num = mean * pop_w4_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess4_dna <- adopt_rate_dna_w4 %>%
left_join(pop_rur_w4_all, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w4_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess4_cs <- bind_rows(ess4_innov, ess4_dna)
# Wave 4: panel weight
ess4_innov_pnl <- adopt_rates_w4_hh %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(abs_num = mean * pop_w5_panel) %>%
filter(!region %in% c("Tigray", "National")) %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess4_dna_pnl <- adopt_rate_dna_w4 %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w5_panel) %>%
filter(!region %in% c("Tigray", "National")) %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess4_pnl <- bind_rows(ess4_innov_pnl, ess4_dna_pnl)
# Wave 5: cross-sectional weights
ess5_innov <- adopt_rates_w5_hh %>%
filter(!variable %in% c("dtmz", "maize_cg")) %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_dna <- adopt_rate_dna_w5 %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_cs <- bind_rows(ess5_innov, ess5_dna)
# Wave 5: panel weights
ess5_innov_pnl <- adopt_rates_w5_hh %>%
filter(!variable %in% c("dtmz", "maize_cg")) %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(abs_num = mean * pop_w5_panel) %>%
filter(!region %in% c("Tigray", "National")) %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_dna_pnl <- adopt_rate_dna_w5 %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w5_panel) %>%
filter(!region %in% c("Tigray", "National")) %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_pnl <- bind_rows(ess5_innov_pnl, ess5_dna_pnl)
ess5_pnl
ess5_pnl %>% count(label)
ess5_pnl %>% count(label) %>% print(n = Inf)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/1_code/10_4_adopt_reach_table.R", echo=TRUE)
for
hh_level_w4
hh_level_w4 %>% glimpse()
var_labs <- as_tibble_col(
c(
"hhd_livIA", "hhd_avocado", "hhd_kabuli", "hhd_consag1",
"hhd_consag2", "hhd_cross_largerum", "hhd_cross_poultry", "hhd_cross_smallrum",
"hhd_grass", "hhd_mango", "hhd_motorpump", "hhd_papaya", "hhd_rdisp",
"hhd_swc", "hhd_awassa83", "hhd_ofsp", "hhd_treadle", "hhd_maize_cg",
"barley_cg", "sorghum_cg"
),
column_name = "variable"
) %>%
mutate(
# labels of innovations
label = case_match(
variable,
"hhd_livIA" ~ "Artificial insemination delivery",
"hhd_avocado" ~ "Avocado trees",
"hhd_kabuli" ~ "Chickpea Kabuli varieties",
"hhd_consag1" ~ "Conservation Agriculture / MT*",
"hhd_consag2" ~ "Conservation Agriculture / ZT*",
"hhd_cross_largerum" ~ "Large ruminants crossbreeds",
"hhd_cross_poultry" ~ "Poultry crossbreeds",
"hhd_cross_smallrum" ~ "Small ruminants crossbreeds",
"hhd_grass" ~ "Forage grasses",
"hhd_mango" ~ "Mango trees",
"hhd_motorpump" ~ "Motorized pumps",
"hhd_papaya" ~ "Papaya trees",
"hhd_rdisp" ~ "River dispersion",
"hhd_swc" ~ "Soil & Water Conservation practices",
"hhd_awassa83" ~ "Sweet potato Awassa-83 variety",
"hhd_ofsp" ~ "Sweet potato OFSP varieties",
"hhd_treadle" ~ "Treadle pumps",
"hhd_maize_cg" ~ "Maize varieties",
"barley_cg" ~ "Barley varieties",
"sorghum_cg" ~ "Sorghum varieties"
),
# categories of innovations
type = case_when(
str_detect(variable, "hhd_cross_|hhd_livIA|hhd_grass") ~ "Animal agriculture",
variable %in% c(
"hhd_maize_cg", "hhd_kabuli", "hhd_ofsp", "hhd_awassa83", "barley_cg", "sorghum_cg"
) ~ "Crop germplasm improvement",
variable %in% c(
"hhd_rdisp", "hhd_treadle", "hhd_motorpump", "hhd_swc", "hhd_consag1",
"hhd_consag2", "hhd_affor", "hhd_mango", "hhd_papaya", "hhd_avocado"
) ~ "Natural resource management"
),
variable_w4 = case_match(
variable,
"hhd_maize_cg" ~ "maize_cg",
.default = variable
)
)
ess5_totals <- bind_rows(
mutate(make_sheet(ess5_cs)$df, sample = "all"),
mutate(make_sheet(ess5_pnl)$df, sample = "panel")
) %>%
select(sample, label, total = Total) %>%
left_join(
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label),
by = "label",
multiple = "all"
) %>%
select(-label) %>%
inner_join(var_labs, by = "variable") %>%
select(sample, variable, label, type, total)
ess4_totals <- bind_rows(
mutate(make_sheet(ess4_cs)$df, sample = "all"),
mutate(make_sheet(ess4_pnl)$df, sample = "panel")
) %>%
select(sample, label, total = Total) %>%
left_join(
bind_rows(adopt_rates_w4_hh, adopt_rate_dna_w4) %>%
distinct(variable, label),
by = "label",
multiple = "all"
) %>%
bind_rows(
data.frame(
sample = c("all", "panel"),
total = c(677591, 677591), # numbers from the first report (see p. 42)
variable = c("hhd_kabuli", "hhd_kabuli")
)
) %>%
select(-label) %>%
inner_join(var_labs, by = c("variable" = "variable_w4")) %>%
select(sample, variable, label, type, total)
adopt_totals <- bind_rows(
ess4_totals %>%
mutate(year = "2018/19"),
ess5_totals %>%
mutate(year = "2021/22")
)
ess4_arrng <- ess4_totals %>%
filter(sample == "all") %>%
arrange(total) %>%
pull(label)
adopt_totals
adopt_totals %>% count(label)
ess5_cs
ess5_cs %>% count(label)
ess5_cs %>% count(label) %>% print(n = Inf)
ess5_cs %>% count(variable, label) %>% print(n = Inf)
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label)
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label) %>% print(n = Inf)
bind_rows(adopt_rates_w4_hh, adopt_rate_dna_w4) %>%
distinct(variable, label)
bind_rows(adopt_rates_w4_hh, adopt_rate_dna_w4) %>%
distinct(variable, label) %>% print(n = Inf)
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label) %>% print(n = Inf)
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label) %>%
filter(variable != "hhd_grass") %>%
mutate(variable = recode(variable, "hhd_grassII" = "hhd_grass"))
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label) %>%
filter(variable != "hhd_grass") %>%
mutate(variable = recode(variable, "hhd_grassII" = "hhd_grass")) %>% print(n  = Inf)
ess5_totals <- bind_rows(
mutate(make_sheet(ess5_cs)$df, sample = "all"),
mutate(make_sheet(ess5_pnl)$df, sample = "panel")
) %>%
select(sample, label, total = Total) %>%
left_join(
bind_rows(adopt_rates_w5_hh, adopt_rate_dna_w5) %>%
distinct(variable, label) %>%
filter(variable != "hhd_grass") %>%
mutate(variable = recode(variable, "hhd_grassII" = "hhd_grass")),
by = "label",
multiple = "all"
) %>%
select(-label) %>%
inner_join(var_labs, by = "variable") %>%
select(sample, variable, label, type, total)
ess4_totals <- bind_rows(
mutate(make_sheet(ess4_cs)$df, sample = "all"),
mutate(make_sheet(ess4_pnl)$df, sample = "panel")
) %>%
select(sample, label, total = Total) %>%
left_join(
bind_rows(adopt_rates_w4_hh, adopt_rate_dna_w4) %>%
distinct(variable, label),
by = "label",
multiple = "all"
) %>%
bind_rows(
data.frame(
sample = c("all", "panel"),
total = c(677591, 677591), # numbers from the first report (see p. 42)
variable = c("hhd_kabuli", "hhd_kabuli")
)
) %>%
select(-label) %>%
inner_join(var_labs, by = c("variable" = "variable_w4")) %>%
select(sample, variable, label, type, total)
adopt_totals <- bind_rows(
ess4_totals %>%
mutate(year = "2018/19"),
ess5_totals %>%
mutate(year = "2021/22")
)
ess4_arrng <- ess4_totals %>%
filter(sample == "all") %>%
arrange(total) %>%
pull(label)
adopt_totals %>%
filter(sample == "panel") %>%
mutate(label = factor(label, levels = ess4_arrng)) %>%
ggplot(aes(label, total, fill = type)) +
geom_col() +
facet_wrap(~year, nrow = 2) +
scale_y_continuous(labels = unit_format(unit = "", scale = 1e-6)) +
theme_Publication() +
scale_fill_Publication() +
theme(
axis.text.x = element_text(
angle = 90,
size = 10,
hjust = 1,
vjust = .4
),
axis.title.y = element_text(size = 11),
legend.position = "top"
) +
labs(
y = "Number of rural households (millions)",
x = "",
fill = "",
title = "Number of rural households adopting each CGIAR-related innovation\nin Ethiopia, ESS - Panel households"
)
adopt_totals %>%
filter(sample == "panel", !variable %in% c("barley_cg", "sorghum_cg")) %>%
mutate(label = factor(label, levels = ess4_arrng)) %>%
ggplot(aes(label, total, fill = type, alpha = year)) +
geom_col(position = "dodge") +
scale_alpha_discrete(range = c(0.45, 1)) +
scale_y_continuous(labels = unit_format(unit = "", scale = 1e-6)) +
theme_Publication() +
scale_fill_Publication() +
theme(
axis.text.x = element_text(
angle = 90,
size = 10,
hjust = 1,
vjust = .4
),
axis.title.y = element_text(size = 11),
legend.position = "top"
) +
guides(alpha = "none") +
labs(
y = "Number of rural households (millions)",
x = "",
fill = "",
alpha = "",
title = "Number of rural households adopting each CGIAR-related innovation in Ethiopia, ESS -
change between 2018/19 (ESS4) and 2021/22 (ESS5)",
caption = "Note: Calculation based on logitudinal weights. For Chickpea Kabuli varieties, comparision is between 2015/16 (ESS3) and 2021/22 (ESS5)"
)
adopt_totals %>%
filter(sample == "panel", !variable %in% c("barley_cg", "sorghum_cg")) %>%
mutate(label = factor(label, levels = ess4_arrng)) %>%
ggplot(aes(label, total, fill = type, alpha = year)) +
geom_col(position = "dodge") +
scale_alpha_discrete(range = c(0.45, 1)) +
scale_y_continuous(labels = unit_format(unit = "", scale = 1e-6)) +
theme_Publication() +
scale_fill_Publication() +
theme(
axis.text.x = element_text(
angle = 90,
size = 10,
hjust = 1,
vjust = .4
),
axis.title.y = element_text(size = 11),
legend.position = "top"
) +
guides(alpha = "none") +
labs(
y = "Number of rural households (millions)",
x = "",
fill = "",
alpha = "",
title = "Number of rural households adopting each CGIAR-related innovation in Ethiopia, ESS -
change between 2018/19 (ESS4) and 2021/22 (ESS5)",
caption = "Note: Calculation based on logitudinal weights. For Chickpea Kabuli varieties, comparision is between 2015/16 (ESS3) and 2021/22 (ESS5)"
)
ggsave(
filename = "../tmp/adopt_reach/figures/fig09_panel_II.png",
width = 300,
height = 200,
units = "mm"
)
