mutate(region = "National", wave = "Wave 4"),
hh_level_w4_urb_hh %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 4"),
hh_level_w4 %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 4"),
hh_level_w4_urb_hh %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 4"),
hh_level_w5 %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 5"),
hh_level_w5_urb_hh %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 5"),
hh_level_w5 %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 5"),
hh_level_w5_urb_hh %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 5")
) %>%
left_join(
labels %>%
mutate( variable = str_replace(variable, "hhd_", "ead_") ),
by = "variable")
innov_ea_all
innov_ea_allv2 <- map2(hh_level_all, my_names, summ_by_ea) %>%
bind_rows()
innov_ea_all <- bind_rows(
hh_level_w4 %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 4"),
hh_level_w4_urb_hh %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 4"),
hh_level_w4 %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 4"),
hh_level_w4_urb_hh %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 4"),
hh_level_w5 %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 5"),
hh_level_w5_urb_hh %>%
group_by(ea_id) %>%
collapse_ea(group_vars = "variable") %>%
mutate(region = "National", wave = "Wave 5"),
hh_level_w5 %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 5"),
hh_level_w5_urb_hh %>%
group_by(ea_id, region) %>%
collapse_ea() %>%
mutate(wave = "Wave 5")
) #%>%
identical(innov_ea_all, innov_ea_allv2)
innov_ea_allv2
innov_ea_all
hh_level_panel <- list(
hh_panel_w4, hh_panel_w4_urb_hh, hh_panel_w5, hh_panel_w5_urb_hh
)
innov_ea_panel <- map2(hh_level_panel, my_names, summ_by_ea) %>%
left_join(
labels %>%
mutate( variable = str_replace(variable, "hhd_", "ead_") ),
by = "variable")
innov_ea_panel <- map2(hh_level_panel, my_names, summ_by_ea) %>%
bind_rows() %>%
left_join(
labels %>%
mutate( variable = str_replace(variable, "hhd_", "ead_") ),
by = "variable")
innov_ea_panel
my_names
innov_ea_panel
innov_ea_all
runApp('adoption_rates_ESS')
labels_choices
library(shiny)
runExample("06_tabsets")    # tabbed panels
runApp('adoption_rates_ESS')
runExample("06_tabsets")
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
labels_choices
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
View(national_hh_level)
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
?shinyAppDir
plot_waves <- function(tbl, level) {
tbl %>%
filter(level == level) %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = maxGrid() + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
}
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
styler:::style_selection()
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
styler:::style_selection()
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
labels_choices
runApp('adoption_rates_ESS')
adoption_rates
adoption_rates %>%
filter(label=="Crossbred Poultry")
adoption_rates %>% count(label)
adoption_rates %>% count(label) %>% View()
adoption_rates %>% count(label)
adoption_rates %>% count(variable, label)
adoption_rates %>% count(variable, label) %>% View()
adoption_rates %>%
filter(variable=="hhd_grass")
adoption_rates %>%
filter(variable=="hhd_grass")
adoption_rates %>%
filter(variable=="hhd_grass")
adoption_rates %>%
filter(variable=="hhd_grass") %>% count(level)
adoption_rates %>%
filter(variable=="hhd_grass") %>% count(label)
adoption_rates %>%
filter(variable == "Feed And Forages: Elephant Grass, Sesbaniya, & Alfalfa")
adoption_rates %>%
filter(variable %in% c("hhd_grass", "ead_grass"))
?sidebarPanel
adoption_rates %>% count(label)
adoption_rates %>% count(label) %>% View()
adoption_rates %>% count(label)
adoption_rates %>% count(label) %>% View()
adoption_rates %>% count(variable, label) %>% View()
adoption_rates %>%
filter(variable %in% c("hhd_impcr2", "ead_impcr2")) %>%
plotShiny()
labels_vec
install.packages("gotop")
install.packages("gotop")
runApp('adoption_rates_ESS')
getwd()
setwd("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/dynamics_presentation")
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
runApp('adoption_rates_ESS')
?radioButtons
?sidebarPanel
comm_psnp_all
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/03_new_innov_ess5.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/01_figs_hh.R", echo=TRUE)
setwd("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis")
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/01_figs_hh.R", echo=TRUE)
sect09_com_w4 <- read_dta(file.path(
root,
"supplemental/replication_files/2_raw_data/ESS4_2018-19/Data/sect09_com_w4.dta"
))
ess5_community_new <- read_dta(file.path(root, w5_dir, "ess5_community_new.dta"))
ess5_comm_psnp <- ess5_community_new %>%
mutate_if(is.labelled, as_factor) %>%
mutate(
across(c(saq01, saq14), ~ str_trim(str_to_title(str_remove(., "\\d+\\."))) ),
wave = "Wave 5",
region = recode(saq01, "Snnp" = "SNNP")
) %>%
select(ea_id, wave, region, locality = saq14, comm_psnp)
ess4_comm_psnp <- sect09_com_w4 %>%
mutate(comm_psnp = case_when(
cs9q01==1 ~ 1,
cs9q01==2 ~ 0
)) %>%
mutate_if(is.labelled, as_factor) %>%
mutate(
across(c(saq01, saq14), ~ str_trim( str_to_title(str_remove(., "\\d+\\.")) ) ),
wave = "Wave 4",
region = recode(saq01, "Snnp" = "SNNP")
) %>%
select(ea_id, wave, region, locality = saq14, comm_psnp)
mean_tbl_nowt <- function(tbl, vars = vars_both, group_vars) {
tbl %>%
pivot_longer(all_of(vars),
names_to = "variable",
values_to = "value") %>%
group_by(pick(group_vars)) %>%
summarise(
mean = mean(value, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
)
}
comm_psnp_all <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Tigray", "Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_local <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Tigray", "Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_all %>%
filter(region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 2.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = .35) +
theme(
legend.position = "top"#,
# legend.margin = margin(t = -0.4, unit = "cm"),
# axis.title = element_text(size = 12.5),
# plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(x = "", y = "Percent", fill = "",
title = "Community PSNP - all EAs (Urban and Rural)")
ggsave(
filename = file.path(root, "tmp/figures/comm_psnp_all.pdf"),
device = cairo_pdf,
width = 180,
height = 127,
units = "mm"
)
comm_psnp_local %>%
filter(region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 2.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = 1.2) +
facet_wrap(~ locality, nrow = 2, scales = "free") +
theme(
legend.position = "top"#,
# legend.margin = margin(t = -0.4, unit = "cm"),
# axis.title = element_text(size = 12.5),
# plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(x = "", y = "Percent", fill = "",
title = "Community PSNP by locality")
ggsave(
filename = file.path(root, "tmp/figures/comm_psnp_local.pdf"),
device = cairo_pdf,
width = 180,
height = 200,
units = "mm"
)
ess5_comm_psnp_panel <- ess5_comm_psnp %>%
semi_join(ess4_comm_psnp, by = "ea_id")
ess4_comm_psnp_panel <- ess4_comm_psnp %>%
semi_join(ess5_comm_psnp, by = "ea_id")
comm_psnp_panel <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_local_panel <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_panel %>%
filter(region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 2.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = 1.2) +
theme(
legend.position = "top"#,
# legend.margin = margin(t = -0.4, unit = "cm"),
# axis.title = element_text(size = 12.5),
# plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(x = "", y = "Percent", fill = "",
title = "Community PSNP - panel EAs (Urban and Rural)")
ggsave(
filename = file.path(root, "tmp/figures/comm_psnp_all_panel.pdf"),
device = cairo_pdf,
width = 180,
height = 127,
units = "mm"
)
comm_psnp_local_panel %>%
filter(region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 2.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = 1.2) +
facet_wrap(~ locality, nrow = 2, scales = "free") +
theme(
legend.position = "top"#,
# legend.margin = margin(t = -0.4, unit = "cm"),
# axis.title = element_text(size = 12.5),
# plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(x = "", y = "Percent", fill = "",
title = "Community PSNP by locality - panel EAs")
ggsave(
filename = file.path(root, "tmp/figures/comm_psnp_local_panel.pdf"),
device = cairo_pdf,
width = 180,
height = 200,
units = "mm"
)
comm_psnp_all
comm_psnp_local
comm_psnp_panel
comm_psnp_all_local <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Tigray", "Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_all_local %>%
filter(region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 2.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = 1.2) +
facet_wrap(~ locality, nrow = 2, scales = "free") +
theme(
legend.position = "top"#,
# legend.margin = margin(t = -0.4, unit = "cm"),
# axis.title = element_text(size = 12.5),
# plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(x = "", y = "Percent", fill = "",
title = "Community PSNP by locality")
comm_psnp_panel
comm_psnp_all_local
bind_rows(
comm_psnp_all,
comm_psnp_all_local %>%
mutate(locality = "Both")
)
bind_rows(
comm_psnp_all %>%
mutate(locality = "Both"),
comm_psnp_all_local
)
comm_psnp_all_agg <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess4_comm_psnp, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess5_comm_psnp, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Tigray", "Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
bind_rows(
comm_psnp_all_agg %>%
mutate(locality = "Aggregate"),
comm_psnp_all_local
)
View(comm_psnp_all)
comm_psnp_panel_agg <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region")),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_panel_local <- bind_rows(
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess4_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National"),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "region", "locality")),
mean_tbl_nowt(ess5_comm_psnp_panel, "comm_psnp", group_vars = c("wave", "locality")) %>%
mutate(region = "National")
) %>%
mutate(
region = fct_relevel(
region,
"Afar", "Amhara", "Oromia", "Somali", "Benishangul Gumuz",
"SNNP", "Gambela", "Harar", "Addis Ababa", "Dire Dawa", "National")
)
comm_psnp_panel <- bind_rows(
comm_psnp_panel_agg %>%
mutate(locality = "Aggregate"),
comm_psnp_panel_local
)
write_csv(comm_psnp_panel, file = "dynamics_presentation/data/comm_psnp_panel.csv")
write_csv(comm_psnp_all, file = "dynamics_presentation/data/comm_psnp_all.csv")
comm_psnp_panel
comm_psnp_panel_agg
comm_psnp_panel
setwd("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/dynamics_presentation")
comm_psnp_all <- read_csv("data/comm_psnp_all.csv")
comm_psnp_panel <- read_csv("data/comm_psnp_panel.csv")
comm_psnp_all
comm_psnp_all <- read_csv("data/comm_psnp_all.csv")
comm_psnp_all
