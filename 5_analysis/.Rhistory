num_ub2 = mean_ub2 * pop_w5_all,
num_lb  = mean_lb * pop_w5_all
) %>%
select(-pop_w5_all) %>%
pivot_longer(
cols = -region,
names_to = c("stat", "type"),
names_sep = "_",
values_to = "value"
) %>%
pivot_wider(
names_from = "stat", values_from = "value"
) %>%
mutate(
label = case_match(
type,
"ub1" ~ "Upper Bound-1",
"ub2" ~ "Upper Bound-2",
"lb" ~ "Lower Bound"
)
) %>%
select(region, label, mean, abs_num = num)
bd_w5
bd_w5 <- bd_mean_w5 %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(
num_ub1 = mean_ub1 * pop_w5_all,
num_ub2 = mean_ub2 * pop_w5_all,
num_lb  = mean_lb * pop_w5_all
) %>%
select(-pop_w5_all) %>%
pivot_longer(
cols = -region,
names_to = c("stat", "type"),
names_sep = "_",
values_to = "value"
) %>%
pivot_wider(
names_from = "stat", values_from = "value"
) %>%
mutate(
label = case_match(
type,
"ub1" ~ "Upper Bound-1",
"ub2" ~ "Upper Bound-2",
"lb" ~ "Lower Bound"
)
) %>%
select(region, label, mean, abs_num = num)
bd_w5_pnl <- bd_mean_w5 %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(
num_ub1 = mean_ub1 * pop_w5_all,
num_ub2 = mean_ub2 * pop_w5_all,
num_lb  = mean_lb * pop_w5_all
) %>%
select(-pop_w5_all) %>%
pivot_longer(
cols = -region,
names_to = c("stat", "type"),
names_sep = "_",
values_to = "value"
) %>%
pivot_wider(
names_from = "stat", values_from = "value"
) %>%
mutate(
label = case_match(
type,
"ub1" ~ "Upper Bound-1",
"ub2" ~ "Upper Bound-2",
"lb" ~ "Lower Bound"
)
) %>%
select(region, label, mean, abs_num = num)
pop_rur_pnl
bd_w5_pnl <- bd_mean_w5 %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(
num_ub1 = mean_ub1 * pop_w5_panel,
num_ub2 = mean_ub2 * pop_w5_panel,
num_lb  = mean_lb * pop_w5_panel
) %>%
select(-pop_w5_all) %>%
pivot_longer(
cols = -region,
names_to = c("stat", "type"),
names_sep = "_",
values_to = "value"
) %>%
pivot_wider(
names_from = "stat", values_from = "value"
) %>%
mutate(
label = case_match(
type,
"ub1" ~ "Upper Bound-1",
"ub2" ~ "Upper Bound-2",
"lb" ~ "Lower Bound"
)
) %>%
select(region, label, mean, abs_num = num)
bd_w5_pnl <- bd_mean_w5 %>%
left_join(pop_rur_pnl, by = "region") %>%
mutate(
num_ub1 = mean_ub1 * pop_w5_panel,
num_ub2 = mean_ub2 * pop_w5_panel,
num_lb  = mean_lb * pop_w5_panel
) %>%
select(-pop_w5_panel) %>%
pivot_longer(
cols = -region,
names_to = c("stat", "type"),
names_sep = "_",
values_to = "value"
) %>%
pivot_wider(
names_from = "stat", values_from = "value"
) %>%
mutate(
label = case_match(
type,
"ub1" ~ "Upper Bound-1",
"ub2" ~ "Upper Bound-2",
"lb" ~ "Lower Bound"
)
) %>%
select(region, label, mean, abs_num = num)
bd_w5_pnl
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
bd_mean_w5
bd_w5
bd_mean_w5
ubounds_w5
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
# Save the workbook as an Excel file
saveWorkbook(wb, file.path(root, "4_table/absolute_numbers.xlsx"), overwrite = TRUE)
openXL(file.path(root, "4_table/absolute_numbers.xlsx"))
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
root
ess4_hh_all <- wave5_hh <- read_dta(file.path(root, "3_report_data/wave5_hh_new.dta"))
wave5_hh <- read_dta(file.path(root, "3_report_data/wave5_hh_new.dta"))
wave5_hh
innovs <- c(
"hhd_livIA", "hhd_cross_largerum", "hhd_cross_smallrum", "hhd_cross_poultry",
"hhd_gaya", "hhd_sasbaniya", "hhd_alfa", "hhd_elepgrass",
"hhd_grass", "hhd_ofsp", "hhd_awassa83", "hhd_rdisp", "hhd_motorpump", "hhd_swc",
"hhd_consag1", "hhd_consag2", "hhd_affor", "hhd_mango", "hhd_papaya", "hhd_avocado"
)
hh_level_w5 <- wave5_hh %>%
select(
household_id, ea_id, wave, region = saq01, starts_with("pw_"), all_of(innovs)
) %>%
recode_region()
innovs <- c(
# animal agriculture:
"hhd_livIA", "hhd_cross_largerum", "hhd_cross_smallrum", "hhd_cross_poultry",
# crop-germplasm improvment:
"hhd_ofsp", "hhd_awassa83", "hhd_kabuli",
"hhd_rdisp", "hhd_motorpump",
"hhd_swc", "hhd_consag1", "hhd_consag2", "hhd_affor", "hhd_mango",
"hhd_papaya", "hhd_avocado", "hotline", "hhd_malt", "hhd_durum",
"hhd_seedv1", "hhd_seedv2", "hhd_agroind", "hhd_elepgrass", "hhd_deshograss",
"hhd_sesbaniya", "hhd_sinar", "hhd_lablab", "hhd_alfalfa", "hhd_vetch", "hhd_rhodesgrass", "hhd_grass", "dtmz",
"maize_cg", "hhd_psnp"
)
innovs_w5 <- c(
# animal agriculture:
"hhd_livIA", "hhd_cross_largerum", "hhd_cross_smallrum", "hhd_cross_poultry",
# forages:
"hhd_agroind", "hhd_elepgrass", "hhd_deshograss", "hhd_sesbaniya", "hhd_sinar",
"hhd_lablab", "hhd_alfalfa", "hhd_vetch", "hhd_rhodesgrass", "hhd_grass",
# crop-germplasm improvment:
"maize_cg", "dtmz", "hhd_ofsp", "hhd_awassa83", "hhd_kabuli",
# Natural resoruce management:
"hhd_rdisp", "hhd_motorpump", "hhd_swc", "hhd_consag1", "hhd_consag2", "hhd_affor",
"hhd_mango", "hhd_papaya", "hhd_avocado", "hhd_malt", "hhd_durum",
# policy influences:
"hhd_psnp", "hotline", "hhd_seedv1", "hhd_seedv2"
)
hh_level_w5 <- wave5_hh %>%
select(
household_id, ea_id, wave, region = saq01, starts_with("pw_"), all_of(innovs_w5)
) %>%
recode_region()
hh_level_w5
hh_level_w5 %>% glimpse()
# calculate means
mean_tbl <- function(tbl, vars, group_vars, pw) {
tbl %>%
pivot_longer(all_of(vars),
names_to = "variable",
values_to = "value") %>%
group_by(pick(group_vars)) %>%
summarise(
mean = weighted.mean(value, w = {{pw}}, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
)
}
means_hh_w5 <- bind_rows(
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable", "region"), pw = pw_w4),
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable"), pw = pw_w4)
) %>%
mutate(wave = paste("Wave", wave))
means_hh_w5 <- bind_rows(
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5),
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable"), pw = pw_w5)
) %>%
mutate(wave = paste("Wave", wave))
means_hh_w5
#
labs <- wave5_hh %>%
select(all_of(innovs_w5)) %>%
var_label() %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
)
labs
# psnp data (generated in 03_new_innov_ess5.R)
psnp_hh <- read_csv("dynamics_presentation/data/psnp_hh.csv")
# modify PSNP
psnp_w5_rur <- psnp_hh %>%
filter(
wave == "Wave 5", locality == "Rural",
sample == "All", region != "Addis Ababa"
) %>%
select(wave, variable, region, mean, nobs, label)
psnp_w5_rur
means_hh_w5
means_hh_w5 %>% count(region)
means_hh_w5 <- bind_rows(
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5),
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable"), pw = pw_w5) %>%
mutate(region = "National")
) %>%
mutate(wave = paste("Wave", wave))
means_hh_w5 %>% count(region)
# create final tibble:
adopt_rates_w5_hh <- means_hh_w5  %>%
left_join(labs, by = "variable") %>%
select(wave, region, variable, label, mean, nobs) %>%
bind_rows(psnp_w5_rur)
write_csv(adopt_rates_w5_hh, file = "dynamics_presentation/data/adopt_rates_w5_hh.csv")
adopt_rates_w5_hh
adopt_rates_w5_hh %>% count(label)
adopt_rates_w5_hh %>% count(label) %>% View()
adopt_rates_w5_hh %>% count(label) %>% View()
adopt_rates_w5_hh <- read_csv("dynamics_presentation/data/adopt_rates_w5_hh.csv")
dna_means_hh
ess5_innov <- adopt_rates_w5_hh %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_dna <- dna_w5 %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_dna
ess5_cs
ess5_dna %>% count(label) %>% view()
ess5_cs %>% count(label) %>% view()
adopt_rates_w5_hh
ess5_innov <- adopt_rates_w5_hh %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_dna <- dna_w5 %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_cs <- bind_rows(ess5_innov, ess5_dna)
ess5_cs %>% count(label) %>% view()
adopt_rates_w5_hh
adopt_rates_w5_hh %>% count(variable, label) %>% print(n = Inf)
innovs_w5 <- c(
# animal agriculture:
"hhd_livIA", "hhd_cross_largerum", "hhd_cross_smallrum", "hhd_cross_poultry",
# forages:
"hhd_agroind", "hhd_elepgrass", "hhd_deshograss", "hhd_sesbaniya", "hhd_sinar",
"hhd_lablab", "hhd_alfalfa", "hhd_vetch", "hhd_rhodesgrass", "hhd_grass",
# crop-germplasm improvment:
"maize_cg", "dtmz", "hhd_ofsp", "hhd_awassa83", "hhd_kabuli",
# Natural resoruce management:
"hhd_rdisp", "hhd_motorpump", "hhd_swc", "hhd_consag1", "hhd_consag2", "hhd_affor",
"hhd_mango", "hhd_papaya", "hhd_avocado", "hhd_malt", "hhd_durum",
# policy influences: (psnp is treated separately)
"hotline", "hhd_seedv1", "hhd_seedv2"
)
hh_level_w5 <- wave5_hh %>%
select(
household_id, ea_id, wave, region = saq01, starts_with("pw_"), all_of(innovs_w5)
) %>%
recode_region()
# calculate means
mean_tbl <- function(tbl, vars, group_vars, pw) {
tbl %>%
pivot_longer(all_of(vars),
names_to = "variable",
values_to = "value") %>%
group_by(pick(group_vars)) %>%
summarise(
mean = weighted.mean(value, w = {{pw}}, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
)
}
means_hh_w5 <- bind_rows(
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5),
mean_tbl(hh_level_w5, innovs_w5, group_vars = c("wave", "variable"), pw = pw_w5) %>%
mutate(region = "National")
) %>%
mutate(wave = paste("Wave", wave))
#
labs <- wave5_hh %>%
select(all_of(innovs_w5)) %>%
var_label() %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
)
# modify PSNP
psnp_w5_rur <- psnp_hh %>%
filter(
wave == "Wave 5", locality == "Rural",
sample == "All", region != "Addis Ababa"
) %>%
select(wave, variable, region, mean, nobs, label)
# create final tibble:
adopt_rates_w5_hh <- means_hh_w5  %>%
left_join(labs, by = "variable") %>%
select(wave, region, variable, label, mean, nobs) %>%
bind_rows(psnp_w5_rur)
write_csv(adopt_rates_w5_hh, file = "dynamics_presentation/data/adopt_rates_w5_hh.csv")
adopt_rates_w5_hh
adopt_rates_w5_hh %>% count(variable)
adopt_rates_w5_hh %>% count(variable) %>% print(n = Inf)
adopt_rates_w5_hh %>% count(variable, label) %>% print(n = Inf)
ess5_innov <- adopt_rates_w5_hh %>%
filter(variable %in% c("dtmz", "maize_cg")) %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_innov
ess5_innov <- adopt_rates_w5_hh %>%
filter(!variable %in% c("dtmz", "maize_cg")) %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_innov
ess5_innov %>% count(label)
ess5_innov %>% count(label) %>% print(n = Inf)
ess5_dna <- dna_w5 %>%
left_join(pop_rur_w5_all, by = "region") %>%
mutate(abs_num = mean * growing_pct * pop_w5_all) %>%
filter(region != "National") %>%
select(region, label, mean, abs_num) %>%
arrange(region, label)
ess5_cs <- bind_rows(ess5_innov, ess5_dna)
ess5_cs %>% count(label) %>% print(n = Inf)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
bounds_w5 <- ess5_bounds %>%
recode_region(saq01) %>%
group_by(region) %>%
summarise(
across(c(starts_with(c("ubound", "lbound")), cr2, anycr), ~weighted.mean(., w = pw_w4, na.rm = T))
) %>%
mutate(across(-region, ~replace_na(., 0))) %>%
rename(maize_pct = cr2, anycr_pct = anycr)
bounds_w5 <- ess5_bounds %>%
recode_region(saq01) %>%
group_by(region) %>%
summarise(
across(c(starts_with(c("ubound", "lbound")), cr2), ~weighted.mean(., w = pw_w5, na.rm = T))
) %>%
mutate(across(-region, ~replace_na(., 0))) %>%
rename(maize_pct = cr2)
bounds_w5
bd_means_w5 <- bounds_w5 %>%
mutate(
maize_pct = if_else(region %in% no_dna_reg, 0, maize_pct),
anycr_pct = if_else(region %in% no_dna_reg, 0, anycr_pct)
) %>%
mutate(
mean_ub = ( ubound1a * maize_pct ) + ( ubound1b * (1 - maize_pct) ),
mean_lb1 = ( lbound1 * maize_pct ),
mean_lb2 = ( lbound2a * anycr_pct ) + ( lbound2b * (1 - anycr_pct) )
) %>%
select(region, starts_with("mean_"))
bounds_w5
bounds_w5 %>% glimpse()
no_dna_reg <- c("Afar", "Benishangul Gumuz", "Gambela", "Somali")
bounds_w5 <- ess5_bounds %>%
recode_region(saq01) %>%
group_by(region) %>%
summarise(
across(c(starts_with(c("ubound", "lbound")), cr2), ~weighted.mean(., w = pw_w5, na.rm = T))
) %>%
mutate(across(-region, ~replace_na(., 0))) %>%
rename(maize_pct = cr2)
bd_mean_w5 <- bounds_w5 %>%
mutate(
mean_ub1 = ( ubound1a * growing_pct ) + ( ubound1b * no_gr_pct ),
mean_ub2 = ( ubound2a * growing_pct ) + ( ubound2b * no_gr_pct ),
mean_lb = ( lbound1a * growing_pct ) + ( lbound1b * no_gr_pct ),
) %>%
select(region, starts_with("mean"))
bounds_w5
bd_mean_w5 <- bounds_w5 %>%
mutate(
mean_ub1 = ( ubound1a * maize_pct ) + ( ubound1b * (1 - maize_pct) ),
mean_ub2 = ( ubound2a * maize_pct ) + ( ubound2b * (1 - maize_pct) ),
mean_lb = ( lbound1a * maize_pct ) + ( lbound1b * (1 - maize_pct) ),
) %>%
select(region, starts_with("mean"))
bd_mean_w5
write_csv(bd_mean_w5, file = "dynamics_presentation/data/bd_mean_w5.csv")
bd_mean_w5 <- read_csv("dynamics_presentation/data/bd_mean_w5.csv")
# calculate means
bd_mean_w5 <- bounds_w5 %>%
mutate(
maize_pct = if_else(region %in% no_dna_reg, 0, maize_pct)
) %>%
mutate(
mean_ub1 = ( ubound1a * maize_pct ) + ( ubound1b * (1 - maize_pct) ),
mean_ub2 = ( ubound2a * maize_pct ) + ( ubound2b * (1 - maize_pct) ),
mean_lb = ( lbound1a * maize_pct ) + ( lbound1b * (1 - maize_pct) ),
) %>%
select(region, starts_with("mean"))
bd_mean_w5
# save
write_csv(bd_mean_w5, file = "dynamics_presentation/data/bd_mean_w5.csv")
bd_mean_w5
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
bd_w5_pnl
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
names(df_lst)[[4]]
dna_means_hh
bounds_w5
bounds_w5 %>%
mutate(
maize_pct = if_else(region %in% no_dna_reg, 0, maize_pct)
)
no_dna_reg
ess5_bounds <- read_dta(file.path(root, "tmp/dynamics/ess5_bounds.dta"))
ess5_bounds
no_dna_reg <- c("Afar", "Benishangul Gumuz", "Gambela", "Somali")
bounds_w5 <- ess5_bounds %>%
recode_region(saq01) %>%
group_by(region) %>%
summarise(
across(c(starts_with(c("ubound", "lbound")), cr2), ~weighted.mean(., w = pw_w5, na.rm = T))
) %>%
mutate(across(-region, ~replace_na(., 0))) %>%
rename(maize_pct = cr2)
bounds_w5 %>%
mutate(
maize_pct = if_else(region %in% no_dna_reg, 0, maize_pct)
)
no_dna_reg <- c("Afar", "Benishangul Gumuz", "Gambela", "Somali")
bounds_w5 <- ess5_bounds %>%
recode_region(saq01) %>%
group_by(region) %>%
summarise(
across(c(starts_with(c("ubound", "lbound")), cr2), ~weighted.mean(., w = pw_w5, na.rm = T))
) %>%
mutate(across(-region, ~replace_na(., 0))) %>%
rename(maize_pct = cr2)
# calculate means
bd_mean_w5 <- bounds_w5 %>%
mutate(
maize_pct = if_else(region %in% no_dna_reg, 0, maize_pct)
) %>%
mutate(
mean_ub1 = ( ubound1a * maize_pct ) + ( ubound1b * (1 - maize_pct) ),
mean_ub2 = ( ubound2a * maize_pct ) + ( ubound2b * (1 - maize_pct) ),
mean_lb = ( lbound1a * maize_pct ) + ( lbound1b * (1 - maize_pct) ),
) %>%
select(region, starts_with("mean"))
# save
write_csv(bd_mean_w5, file = "dynamics_presentation/data/bd_mean_w5.csv")
bd_mean_w5 <- read_csv("dynamics_presentation/data/bd_mean_w5.csv")
bd_mean_w5
bounds_w5
bounds_w5 %>%
mutate(
maize_pct = if_else(region %in% no_dna_reg, 0, maize_pct)
)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/08_innov_ess5.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/08_innov_ess5.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/07_innov_ess4.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/absolute_numbers.R", echo=TRUE)
