group_by(region) %>%
summarize_dna_hh(pw = pw_w5) %>%
mutate(wave = "Wave 5"),
ess5_dna_hh_new %>%
summarize_dna_hh(pw = pw_w5) %>%
mutate(region = "National", wave = "Wave 5")
) %>%
pivot_longer(c("hhd_maize_cg", "hhd_dtmz"),
names_to = "variable",
values_to = "mean") %>%
mutate(region = fct_relevel(
region,
"Tigray", "Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
# panel hhs only
ess4_dna_hh_panel <- ess4_dna_hh_new %>%
semi_join(ess5_dna_hh_new,
by = "household_id") %>%
left_join(dplyr::select(ess5_weights_hh, household_id, pw_panel),
by = "household_id")
ess5_dna_hh_panel <- ess5_dna_hh_new %>%
semi_join(ess4_dna_hh_new,
by = "household_id") %>%
left_join(dplyr::select(ess5_weights_hh, household_id, pw_panel),
by = "household_id")
dna_means_hh_panel <- bind_rows(
ess4_dna_hh_panel %>%
group_by(region) %>%
summarize_dna_hh(pw = pw_panel) %>%
mutate(wave = "Wave 4"),
ess4_dna_hh_panel %>%
summarize_dna_hh(pw = pw_panel) %>%
mutate(region = "National", wave = "Wave 4"),
ess5_dna_hh_panel %>%
group_by(region) %>%
summarize_dna_hh(pw = pw_panel) %>%
mutate(wave = "Wave 5"),
ess5_dna_hh_panel %>%
summarize_dna_hh(pw = pw_panel) %>%
mutate(region = "National", wave = "Wave 5")
) %>%
pivot_longer(c("hhd_maize_cg", "hhd_dtmz"),
names_to = "variable",
values_to = "mean") %>%
mutate(region = fct_relevel(
region,
"Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
dna_means_hh <- bind_rows(
dna_means_hh_all %>%
mutate(sample = "All households/EA", level = "Household"),
dna_means_hh_panel %>%
mutate(sample = "Panel households/EA", level = "Household")
) %>%
mutate(label = case_when(
variable == "hhd_maize_cg" ~ "Maize - CG germplasm (DNA data)",
variable == "hhd_dtmz" ~ "Drought tolerant maize (DNA data)"
)
)
write_csv(dna_means_hh, "dynamics_presentation/data/dna_means_hh.csv")
# EA level
ess4_dna_ea_all <- ess4_dna_hh_new %>%
group_by(region, ea_id) %>%
summarise(
ead_maize_cg = max(maize_cg, na.rm = T),
ead_dtmz = max(dtmz, na.rm = T),
.groups = "drop"
)
ess5_dna_ea_all <- ess5_dna_hh_new %>%
group_by(region, ea_id) %>%
summarise(
ead_maize_cg = max(maize_cg, na.rm = T),
ead_dtmz = max(dtmz, na.rm = T),
.groups = "drop"
)
summarize_dna_ea <- function(tbl) {
tbl %>%
summarise(
ead_maize_cg = mean(ead_maize_cg, na.rm = TRUE),
ead_dtmz = mean(ead_dtmz, na.rm = TRUE),
nobs = n()
)
}
dna_means_ea_all <- bind_rows(
ess4_dna_ea_all %>%
group_by(region) %>%
summarize_dna_ea() %>%
mutate(wave = "Wave 4"),
ess4_dna_ea_all %>%
summarize_dna_ea() %>%
mutate(region = "National", wave = "Wave 4"),
ess5_dna_ea_all %>%
group_by(region) %>%
summarize_dna_ea() %>%
mutate(wave = "Wave 5"),
ess5_dna_ea_all %>%
summarize_dna_ea() %>%
mutate(region = "National", wave = "Wave 5")
) %>%
pivot_longer(c("ead_maize_cg", "ead_dtmz"),
names_to = "variable",
values_to = "mean")
ess4_dna_ea_panel <- ess4_dna_hh_panel %>%
group_by(region, ea_id) %>%
summarise(
ead_maize_cg = max(maize_cg, na.rm = T),
ead_dtmz = max(dtmz, na.rm = T),
.groups = "drop"
)
ess5_dna_ea_panel <- ess5_dna_hh_panel %>%
group_by(region, ea_id) %>%
summarise(
ead_maize_cg = max(maize_cg, na.rm = T),
ead_dtmz = max(dtmz, na.rm = T),
.groups = "drop"
)
dna_means_ea_panel <- bind_rows(
ess4_dna_ea_panel %>%
group_by(region) %>%
summarize_dna_ea() %>%
mutate(wave = "Wave 4"),
ess4_dna_ea_panel %>%
summarize_dna_ea() %>%
mutate(region = "National", wave = "Wave 4"),
ess5_dna_ea_panel %>%
group_by(region) %>%
summarize_dna_ea() %>%
mutate(wave = "Wave 5"),
ess5_dna_ea_panel %>%
summarize_dna_ea() %>%
mutate(region = "National", wave = "Wave 5")
) %>%
pivot_longer(c("ead_maize_cg", "ead_dtmz"),
names_to = "variable",
values_to = "mean")
dna_means_ea <- bind_rows(
dna_means_ea_all %>%
mutate(sample = "All households/EA", level = "EA"),
dna_means_ea_panel %>%
mutate(sample = "Panel households/EA", level = "EA")
) %>%
mutate(label = case_when(
variable == "ead_maize_cg" ~ "Maize - CG germplasm (DNA data)",
variable == "ead_dtmz" ~ "Drought tolerant maize (DNA data)"
)
)
write_csv(dna_means_ea, "dynamics_presentation/data/dna_means_ea.csv")
plot_dna <- function(tbl, ylim) {
tbl %>%
filter(region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 2), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 2.5) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
expand_limits(y = ylim) +
labs(x = "", y = "Percent", fill = "")
}
maize_plot <- dna_means %>%
filter(improvment == "hhd_maize_cg") %>%
plot_dna(ylim = 1) +
labs(title = "Maize - CG germplasm")
hh_panel_dna_w4 <- hh_panel_w4 %>%
semi_join(ess4_dna_hh_panel, by = "household_id") %>%
mutate(wave = paste("Wave", wave))
hh_panel_dna_w5 <- hh_panel_w5 %>%
semi_join(ess5_dna_hh_panel, by = "household_id") %>%
mutate(wave = paste("Wave", wave))
psnp_panel_dna_w4 <- psnp_w4_panel %>%
semi_join(ess4_dna_hh_panel, by = "household_id")
psnp_panel_dna_w5 <- psnp_w5_panel %>%
semi_join(ess5_dna_hh_panel, by = "household_id")
national_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable"), pw = pw_panel),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable"), pw = pw_panel),
mean_tbl(psnp_panel_dna_w4, vars = c("hhd_psnp", "hhd_psnp_dir", "hhd_psnp_any"),
group_vars = c("wave", "variable"), pw = pw_panel),
mean_tbl(psnp_panel_dna_w5, vars = c("hhd_psnp", "hhd_psnp_dir", "hhd_psnp_any"),
group_vars = c("wave", "variable"), pw = pw_panel)
) %>%
left_join(labels, by = "variable") %>%
select(wave, variable, label, mean, nobs)
regions_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable", "region"), pw = pw_panel),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable", "region"), pw = pw_panel),
mean_tbl(psnp_panel_dna_w4, vars = c("hhd_psnp", "hhd_psnp_dir", "hhd_psnp_any"),
group_vars = c("wave", "variable", "region"), pw = pw_panel),
mean_tbl(psnp_panel_dna_w5, vars = c("hhd_psnp", "hhd_psnp_dir", "hhd_psnp_any"),
group_vars = c("wave", "variable", "region"), pw = pw_panel)
) %>%
left_join(labels, by = "variable") %>%
select(wave, region, variable, label, mean, nobs)
adopt_rates_panel_hh_dna <- bind_rows(
regions_hh_panel_dna,
national_hh_panel_dna %>%
mutate(region = "National")
) %>%
mutate(region = fct_relevel(
region,
"Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "Panel DNA sample only")
plot_waves <- function(tbl) {
tbl %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
}
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "Panel DNA sample only")
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/dynamics_presentation/helpers/ggplot_theme_Publication-2.R", echo=TRUE)
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "Panel DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "Panel DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_psnp_any"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "PSNP - both temporary labor and direct assistance",
subtitle = "Panel DNA sample only")
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/synergies_col.R", echo=TRUE)
cell_ht_all  %>%
kable(
escape = F, align = "c", col.names = c("", col_hd),
caption = "Summary matrix of joint adoption rates, 2018/19 vs. 2021/22 --- All households"
) %>%
add_header_above(c("", x)) %>%
column_spec(seq(1, row_n, by = 2), border_right = T) %>%
column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
column_spec(1, width_min = "4cm") %>%
kable_styling(full_width = FALSE, fixed_thead = TRUE)
cell_ht_pnl  %>%
kable(escape = F, align = "c", col.names = c("", col_hd),
caption = "Summary matrix of joint adoption rates, 2018/19 vs. 2021/22 --- Panel households") %>%
add_header_above(c("", x)) %>%
column_spec(seq(1, row_n, by = 2), border_right = T) %>%
column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
column_spec(1, width_min = "4cm") %>%
kable_styling(full_width = FALSE, fixed_thead = TRUE)
?column_spec
library(haven)
sect_cover_hh_w4 <- read_dta("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/supplemental/replication_files/2_raw_data/ESS4_2018-19/Data/sect_cover_hh_w4.dta")
sect_cover_hh_w4
sect_cover_hh_w4 %>% count(saq01, saq14)
sect_cover_hh_w4 <- read_dta(
"C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/supplemental/replication_files/2_raw_data/ESS4_2018-19/Data/sect_cover_hh_w4.dta"
) %>%
mutate_if(is.labelled, as_factor)
sect_cover_hh_w4
sect_cover_hh_w4 %>%
count(saq01, saq14)
?count
sect_cover_hh_w4 %>%
count(saq01, saq14, wt = pw_w4)
sect_cover_hh_w4 %>%
count(saq01, saq14, wt = pw_w4) %>% View()
sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4) %>%
summarise(sum(n))
# Do the same for wave 5
sect_cover_pp_w5 <- read_dta(
"C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/2_raw_data/data/PP/sect_cover_pp_w5.dta"
)  %>%
mutate_if(is.labelled, as_factor)
sect_cover_pp_w5 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4)
sect_cover_pp_w5 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w5)
sect_cover_pp_w5
sect_cover_pp_w5 %>%
count(saq01, saq14, wt = pw_w5)
sect_cover_pp_w5 %>%
count(saq01, saq14, wt = pw_w5)
sect_cover_hh_w4 %>%
# filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4)
sect_cover_hh_w4 %>%
# filter(saq14 == "RURAL") %>%
count(saq01, saq14, wt = pw_w4)
sect_cover_pp_w5 %>%
count(saq01, saq14, wt = pw_w5)
sect_cover_hh_w4
sect_cover_hh_w4 %>%
filter(saq14 == "RURAL")
ESS5_weights_hh <- read_dta(
"C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/2_raw_data/data/HH/ESS5_weights_hh.dta"
) %>%
mutate_if(is.labelled, as_factor)
ESS5_weights_hh
sect_cover_hh_w4
ESS5_weights_hh %>%
count(saq01, saq14, wt = pw_w5)
ESS5_weights_hh
ESS5_weights_hh %>%
count(region, rururb, wt = pw_w5)
sect_cover_hh_w4 %>%
count(saq01, saq14, wt = pw_w4)
sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4)
ESS5_weights_hh %>%
filter(saq14 == "Rural") %>%
count(saq01, wt = pw_w5)
ESS5_weights_hh %>%
filter(rururb == "Rural") %>%
count(region, wt = pw_w5)
pop_rur_w4 <- sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4)
pop_rur_w5 <- ESS5_weights_hh %>%
filter(rururb == "Rural") %>%
count(region, wt = pw_w5)
pop_rur_w4
pop_rur_w5
pop_rur_w4 <- sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4) %>%
mutate(region = str_to_sentence(saq01))
pop_rur_w4
pop_rur_w4 <- sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4) %>%
mutate(region = str_to_sentence(saq01)) %>%
select(region, n)
pop_rur_w4
pop_rur_w5 <- ESS5_weights_hh %>%
filter(rururb == "Rural") %>%
count(region, wt = pw_w5) %>%
mutate(region = str_to_title(region))
pop_rur_w5
pop_rur_w4
pop_rur_w4 <- sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4) %>%
mutate(region = str_to_title(saq01)) %>%
select(region, wave4_n = n)
pop_rur_w4
pop_rur_w4 <- sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4) %>%
mutate(region = str_to_title(saq01)) %>%
select(region, wave4_n = n) %>%
bind_rows(data.frame(region = "National", wave4_n = sum(.$wave4_n)))
pop_rur_w4
pop_rur_w5
pop_rur_w5 <- ESS5_weights_hh %>%
filter(rururb == "Rural") %>%
count(region, wt = pw_w5) %>%
mutate(region = str_to_title(region))  %>%
rename(wave5_n = n) %>%
bind_rows(data.frame(region = "National (exc. Tigray)", wave5_n = sum(.$wave5_n)))
pop_rur_w5
library(kableExtra)
inner_join(pop_rur_w4, pop_rur_w5)
inner_join(pop_rur_w4, pop_rur_w5)
pop_rur_w4 <- sect_cover_hh_w4 %>%
filter(saq14 == "RURAL") %>%
count(saq01, wt = pw_w4) %>%
mutate(region = str_to_title(saq01)) %>%
select(region, wave4_n = n) %>%
bind_rows(data.frame(region = "National", wave4_n = sum(.$wave4_n)))
pop_rur_w5 <- ESS5_weights_hh %>%
filter(rururb == "Rural") %>%
count(region, wt = pw_w5) %>%
mutate(region = str_to_title(region))  %>%
rename(wave5_n = n) %>%
bind_rows(data.frame(region = "National", wave5_n = sum(.$wave5_n)))
pop_rur_w4
left_join(pop_rur_w4, pop_rur_w5)
pop_rur_w4
pop_rur_w5
?fuzzy_join
??fuzzy_join
library(fuzzyjoin)
fuzzy_join(pop_rur_w4, pop_rur_w5, by = "region")
tabpath <- "C:/Users/l.daba/SPIA Dropbox/Lemi Daba/Apps/Overleaf/ESS_adoption_matrices/tables"
tabpath <- "C:/Users/l.daba/SPIA Dropbox/Lemi Daba/Apps/Overleaf/ESS_adoption_matrices/tables"
pop_rur_w4  %>%
kable(
escape = F, align = "c", col.names = c("", col_hd),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22"
) %>%
column_spec(1, width_min = "4cm") %>%
column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
kable_styling(full_width = FALSE, fixed_thead = TRUE) %>%
save_kable(file.path(tabpath, "pop_rur_w4.tex"))
pop_rur_w4  %>%
kable(
type = "latex"
escape = F, align = c("l", "c"),
pop_rur_w4  %>%
kable(
type = "latex",
escape = F, align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22"
) %>%
# column_spec(1, width_min = "4cm") %>%
# column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
kable_styling(full_width = FALSE, fixed_thead = TRUE) %>%
save_kable(file.path(tabpath, "pop_rur_w4.tex"))
pop_rur_w4  %>%
kable(
type = "latex",
booktabs = TRUE,
align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22"
) %>%
# column_spec(1, width_min = "4cm") %>%
# column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
save_kable(file.path(tabpath, "pop_rur_w4.tex"))
pop_rur_w4
pop_rur_w4  %>%
kable(
type = "latex",
booktabs = TRUE,
align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22"
)
pop_rur_w4  %>%
kable(
format = "latex",
booktabs = TRUE,
align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22"
)
pop_rur_w4  %>%
kable(
format = "latex",
booktabs = TRUE,
align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22"
) %>%
# column_spec(1, width_min = "4cm") %>%
# column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
save_kable(file.path(tabpath, "pop_rur_w4.tex"))
pop_rur_w4  %>%
kable(
format = "latex",
booktabs = TRUE,
align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22",
linesep = ""
) %>%
# column_spec(1, width_min = "4cm") %>%
# column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
save_kable(file.path(tabpath, "pop_rur_w4.tex"))
pop_rur_w5  %>%
kable(
format = "latex",
booktabs = TRUE,
align = c("l", "c"),
col.names = c("Region", "No. of hhs"),
caption = "Number of rural households, ESPS - 2018/19 vs. 2021/22",
linesep = ""
) %>%
# column_spec(1, width_min = "4cm") %>%
# column_spec(2:row_n, width_min = "2cm", width = "2cm") %>%
kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
save_kable(file.path(tabpath, "pop_rur_w5.tex"))
