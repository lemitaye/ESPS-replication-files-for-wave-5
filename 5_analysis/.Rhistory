adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
labs(title = "Conservation Agriculture with Zero Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
labs(title = "Conservation Agriculture with Minimum Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
labs(title = "Conservation Agriculture with Zero Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = 2.5) +
labs(title = "Conservation Agriculture with Zero Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .25) +
labs(title = "Conservation Agriculture with Zero Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
labs(title = "Conservation Agriculture with Minimum Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .5) +
labs(title = "Conservation Agriculture with Minimum Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .6) +
labs(title = "Conservation Agriculture with Minimum Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "DNA sample only")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "DNA sample only")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "DNA sample only")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "DNA sample only")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "DNA sample only")
adopt_rates_all_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "DNA sample only")
hh_panel_w4 <- hh_level_w4 %>%
semi_join(hh_level_w5, by = "household_id") %>%
inner_join(select(hh_level_w5, household_id, pw_panel),
by = "household_id")
hh_panel_w5 <- hh_level_w5 %>%
semi_join(hh_level_w4, by = "household_id")
hh_panel_w4
hh_panel_dna_w4 <- hh_panel_w4 %>%
semi_join(ess4_dna_hh_new, by = "household_id")
hh_panel_dna_w5 <- hh_panel_w5 %>%
semi_join(ess5_dna_hh_new, by = "household_id")
national_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable"), pw = pw_w4),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable"), pw = pw_w5)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, variable, label, mean, nobs)
regions_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable", "region"), pw = pw_w4),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, region, variable, label, mean, nobs)
adopt_rates_all_hh_dna <- bind_rows(
regions_hh_panel_dna,
national_hh_panel_dna %>%
mutate(region = "National")
) %>%
mutate(region = fct_relevel(
region,
"Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
adopt_rates_panel_hh_dna <- bind_rows(
regions_hh_panel_dna,
national_hh_panel_dna %>%
mutate(region = "National")
) %>%
mutate(region = fct_relevel(
region,
"Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
hh_panel_dna_w4
hh_panel_dna_w5
ess4_dna_hh_panel <- ess4_dna_hh_new %>%
semi_join(ess5_dna_hh_new,
by = "household_id") %>%
left_join(dplyr::select(ess5_weights_hh, household_id, pw_panel),
by = "household_id")
ess5_dna_hh_panel <- ess5_dna_hh_new %>%
semi_join(ess4_dna_hh_new,
by = "household_id") %>%
left_join(dplyr::select(ess5_weights_hh, household_id, pw_panel),
by = "household_id")
ess5_weights_hh <- read_dta(file.path(root, "2_raw_data/data/HH/ESS5_weights_hh.dta"))
summarize_dna_hh <- function(tbl, pw) {
tbl %>%
summarise(
hhd_maize_cg = weighted.mean(maize_cg, w = {{pw}}, na.rm = TRUE),
hhd_dtmz = weighted.mean(dtmz, w = {{pw}}, na.rm = TRUE),
nobs = sum(!is.na(maize_cg))
)
}
ess4_dna_hh_panel <- ess4_dna_hh_new %>%
semi_join(ess5_dna_hh_new,
by = "household_id") %>%
left_join(dplyr::select(ess5_weights_hh, household_id, pw_panel),
by = "household_id")
ess5_dna_hh_panel <- ess5_dna_hh_new %>%
semi_join(ess4_dna_hh_new,
by = "household_id") %>%
left_join(dplyr::select(ess5_weights_hh, household_id, pw_panel),
by = "household_id")
ess4_dna_hh_panel
ess5_dna_hh_panel
hh_panel_dna_w4 <- hh_panel_w4 %>%
semi_join(ess4_dna_hh_panel, by = "household_id")
hh_panel_dna_w5 <- hh_panel_w5 %>%
semi_join(ess5_dna_hh_panel, by = "household_id")
hh_panel_dna_w4
hh_panel_dna_w5 <- hh_panel_w5 %>%
semi_join(ess5_dna_hh_panel, by = "household_id")
hh_panel_dna_w5
national_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable"), pw = pw_w4),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable"), pw = pw_w5)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, variable, label, mean, nobs)
regions_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable", "region"), pw = pw_w4),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, region, variable, label, mean, nobs)
national_hh_panel_dna
regions_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable", "region"), pw = pw_w4),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable", "region"), pw = pw_w5)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, region, variable, label, mean, nobs)
regions_hh_panel_dna
adopt_rates_panel_hh_dna <- bind_rows(
regions_hh_panel_dna,
national_hh_panel_dna %>%
mutate(region = "National")
) %>%
mutate(region = fct_relevel(
region,
"Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "DNA sample only")
hh_panel_dna_w4
hh_panel_dna_w4 %>% glimpse()
hh_panel_dna_w5 %>% glimpse()
hh_panel_dna_w4 <- hh_panel_w4 %>%
semi_join(ess4_dna_hh_panel, by = "household_id")
hh_panel_dna_w5 <- hh_panel_w5 %>%
semi_join(ess5_dna_hh_panel, by = "household_id")
national_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable"), pw = pw_panel),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable"), pw = pw_panel)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, variable, label, mean, nobs)
regions_hh_panel_dna <- bind_rows(
mean_tbl(hh_panel_dna_w4, group_vars = c("wave", "variable", "region"), pw = pw_panel),
mean_tbl(hh_panel_dna_w5, group_vars = c("wave", "variable", "region"), pw = pw_panel)
) %>%
mutate(wave = paste("Wave", wave)) %>%
left_join(labels, by = "variable") %>%
select(wave, region, variable, label, mean, nobs)
adopt_rates_panel_hh_dna <- bind_rows(
regions_hh_panel_dna,
national_hh_panel_dna %>%
mutate(region = "National")
) %>%
mutate(region = fct_relevel(
region,
"Amhara", "Oromia", "SNNP", "Harar", "Dire Dawa", "National"
))
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "Panel DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag2"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .025) +
labs(title = "Conservation Agriculture with Zero Tillage",
subtitle = "Panel DNA sample only")
adopt_rates_panel_hh_dna %>%
filter(variable %in% c("hhd_consag1"), region != "Tigray") %>%
plot_waves() +
expand_limits(y = .7) +
labs(title = "Conservation Agriculture with Minimum Tillage",
subtitle = "Panel DNA sample only")
root
read_dta(file.path(root, "2_raw_data/data/HH", "sect11_hh_w5.dta"))
read_dta(file.path(root, "2_raw_data/data/HH", "sect11_hh_w5.dta"))
sect11_hh_w4 <- read_dta(file.path(root, "supplemental/replication_files/2_raw_data/ESS4_2018-19/Data",
"sect11_hh_w4.dta"))
sect11_hh_w5
sect11_hh_w5 <- read_dta(file.path(root, "2_raw_data/data/HH", "sect11_hh_w5.dta"))
sect11_hh_w5
sect11_hh_w4
sect11_hh_w4 %>% glimpse()
sect11_hh_w5 %>% glimpse()
?recode
?case_match
sect11_hh_w5 %>% count(s11q00)
sect11_hh_w5 %>%
mutate(HHown_item = case_match(s11q00, 2 ~ 0)) %>%
select(household_id, asset_cd, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_match(s11q00, 2 ~ 0, NA ~ 0)) %>%
select(household_id, asset_cd, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0)) %>%
select(household_id, asset_cd, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0)) %>%
select(household_id, asset_cd, s11q00, HHown_item)
?case_when
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0), .default = s11q00) %>%
select(household_id, asset_cd, s11q00, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0), .default = s11q00) %>%
select(household_id, asset_cd, s11q00, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = s11q00)) %>%
select(household_id, asset_cd, s11q00, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = s11q00)) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>%
count(HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = s11q00)) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>%
mutate_if(is.labelled, as.character)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = s11q00)) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>%
mutate_if(is.labelled, as_factor)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>%
mutate_if(is.labelled, as_factor)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, s11q00, HHown_item)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>% count(asset_cd)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>% count(asset_cd) %>% View()
sect11_hh_w5 %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, s11q00, HHown_item) %>%
filter(asset_cd >= 29) %>%
mutate_if(is.labelled, as_factor)
sect11_hh_w5 %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, HHown_item) %>%
filter(asset_cd >= 29) %>%
mutate_if(is.labelled, as_factor)
sect11_hh_w4 %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, HHown_item) %>%
filter(asset_cd >= 29) %>%
mutate_if(is.labelled, as_factor)
map(
list(sect11_hh_w5, sect11_hh_w4),
function (tbl) {
tbl %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(household_id, asset_cd, HHown_item) %>%
filter(asset_cd >= 29) %>%
mutate_if(is.labelled, as_factor)
}
)
map(
list(
mutate(sect11_hh_w5, wave = "Wave 5"),
mutate(sect11_hh_w4, wave = "Wave 4")
),
function (tbl) {
tbl %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(wave, household_id, asset_cd, HHown_item) %>%
filter(asset_cd >= 29) %>%
mutate_if(is.labelled, as_factor)
}
)
prod_assets <- map(
list(
mutate(sect11_hh_w5, wave = "Wave 5"),
mutate(sect11_hh_w4, wave = "Wave 4")
),
function (tbl) {
tbl %>%
mutate(HHown_item = case_when(
s11q00 == 2 ~ 0, is.na(s11q00) ~ 0, .default = as.numeric(s11q00))
) %>%
select(wave, household_id, asset_cd, HHown_item) %>%
filter(asset_cd >= 29) %>%
mutate_if(is.labelled, as_factor)
}
) %>%
bind_rows()
prod_assets
prod_assets %>% count(asset_cd)
prod_assets %>% count(wave, asset_cd)
prod_assets %>%
group_by(wave, asset_cd) %>%
summarize(mean(hhown_item))
prod_assets %>%
group_by(wave, asset_cd) %>%
summarize(mean(HHown_item))
track_hh <- read_dta(file.path(root, "tmp/dynamics/06_1_track_hh.dta"))
track_hh
prod_assets
prod_assets %>%
left_join(track_hh, by = "household_id")
prod_assets %>%
left_join(
select(track_hh, household_id, hh_status, starts_with("pw")),
by = "household_id"
)
select(track_hh, household_id, hh_status, starts_with("pw"))
select(track_hh, household_id, hh_status, starts_with("pw"))
track_hh %>% glimpse()
track_hh <- read_dta(file.path(root, "tmp/dynamics/06_1_track_hh.dta"))
track_hh
select(track_hh, household_id, hh_status, starts_with("pw"))
prod_assets %>% distinct(household_id)
prod_assets %>%
semi_join(
select(track_hh, household_id, hh_status, starts_with("pw")),
by = "household_id"
)
prod_assets %>%
inner_join(
select(track_hh, household_id, hh_status, starts_with("pw")),
by = "household_id"
)
prod_assets_rural <- prod_assets %>%
# retain only rural households (vs. all hhs, i.e., urban included)
inner_join(
select(track_hh, household_id, hh_status, starts_with("pw")),
by = "household_id"
)
prod_assets_rural
prod_assets_rural %>% glimpse()
prod_assets_rural %>% count(hh_status)
prod_assets_rural %>%
filter(hh_status %in% c(2, 3)) %>% distinct(household_id)
prod_assets_rural %>%
filter(hh_status %in% c(2, 3)) %>%
group_by(wave, asset_cd) %>%
summarize(weighted.mean(HHown_item, w = pw_w4))
prod_assets_rural %>%
filter(hh_status %in% c(2, 3)) %>%
group_by(asset_cd) %>%
summarize(weighted.mean(HHown_item, w = pw_w4))
prod_assets_rural %>%
filter(hh_status %in% c(2, 3)) %>%
group_by(asset_cd) %>%
summarize(wave4_mean = weighted.mean(HHown_item, w = pw_w4))
prod_assets_rural %>%
filter(wave = "wave 4") %>%
group_by(asset_cd) %>%
summarize(wave4_mean = weighted.mean(HHown_item, w = pw_w4))
prod_assets_rural %>%
filter(wave == "wave 4") %>%
group_by(asset_cd) %>%
summarize(wave4_mean = weighted.mean(HHown_item, w = pw_w4))
prod_assets_rural %>%
filter(wave == "wave 4")
prod_assets_rural %>%
filter(wave == "Wave 4")
prod_assets_rural %>%
filter(wave == "Wave 4") %>%
group_by(asset_cd) %>%
summarize(wave4_mean = weighted.mean(HHown_item, w = pw_w4))
prod_assets_rural %>%
filter(wave == "Wave 4") %>%
group_by(asset_cd) %>%
summarize(wave4_mean = weighted.mean(HHown_item, w = pw_w4, na.rm = T))
?weighted.mean
prod_assets_rural %>%
filter(wave == "Wave 4") %>%
group_by(asset_cd) %>%
summarize(
wave4_mean = weighted.mean(HHown_item, w = pw_w4, na.rm = T)
)
prod_assets_rural %>%
filter(wave == "Wave 4") %>%
filter(is.na(HHown_item))
prod_assets_rural %>%
filter(wave == "Wave 4") %>%
group_by(asset_cd) %>%
summarize(
wave4_mean = mean(HHown_item, na.rm = T)
# wave4_mean = weighted.mean(HHown_item, w = pw_w4, na.rm = T)
)
prod_assets_rural %>%
filter(wave == "Wave 4") %>%
group_by(asset_cd) %>%
summarize(
wave4_mean = mean(HHown_item, na.rm = T),
wave4_mean2 = weighted.mean(HHown_item, w = pw_w4, na.rm = T)
)
prod_assets_rural %>%
filter(wave == "Wave 4") %>% filter(is.na(pw_w4))
