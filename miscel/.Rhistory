pw = pw_w4),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable"), pw = pw_w5),
,
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable", "region"), pw = pw_w5)
)
grass_means <- bind_rows(
mean_tbl(wave4_grass, vars = "hhd_grassII", group_vars = c("wave", "variable"),
pw = pw_w4),
mean_tbl(wave4_grass, vars = "hhd_grassII", group_vars = c("wave", "variable", "region"),
pw = pw_w4),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable"), pw = pw_w5),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable", "region"), pw = pw_w5)
)
grass_means
grass_means <- bind_rows(
mean_tbl(wave4_grass, vars = "hhd_grassII", group_vars = c("wave", "variable"),
pw = pw_w4),
mean_tbl(wave4_grass, vars = "hhd_grassII", group_vars = c("wave", "variable", "region"),
pw = pw_w4),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable"), pw = pw_w5),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable", "region"), pw = pw_w5)
) %>%
replace_na(list(region = "National"))
grass_means
grass_means %>%
filter(variable == "hhd_grassII")
grass_means %>%
filter(variable == "hhd_grassII") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
library(scales)
grass_means %>%
filter(variable == "hhd_grassII") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/miscel/dynamics_presentation/adoption_rates_ESS/helpers/ggplot_theme_Publication-2.R", echo=TRUE)
grass_means %>%
filter(variable == "hhd_grassII") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
grass_means %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass"
)
grass_means %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass"
) %>% View()
grass_means %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
grass_means %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
) +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
library(haven)
track_hh <- read_dta("../tmp/dynamics/06_1_track_hh.dta")
track_hh
# some cleaning ----
wave4_grass <- wave4_hh %>%
rename(hhd_sesbaniya = hhd_sasbaniya, hhd_alfalfa = hhd_alfa) %>%
mutate(hhd_grassII = case_when(
hhd_elepgrass==100 | hhd_sesbaniya==100 | hhd_alfalfa==100 | hhd_gaya==100 ~ 1,
hhd_elepgrass==0 & hhd_sesbaniya==0 & hhd_alfalfa==0 & hhd_gaya==0 ~ 0
)) %>%
select(household_id:saq01, hhd_grassII) %>%
mutate(wave = "Wave 4") %>%
recode_region(saq01) %>%
left_join(track_hh, by = "household_id")
wave5_grass <- wave5_hh %>%
select(household_id:saq01, hhd_grass, hhd_grassII) %>%
mutate(wave = "Wave 5") %>%
recode_region(saq01) %>%
left_join(track_hh, by = "household_id")
wave5_grass
wave5_grass
wave5_grass %>% glimpse()
# some cleaning ----
wave4_grass <- wave4_hh %>%
rename(hhd_sesbaniya = hhd_sasbaniya, hhd_alfalfa = hhd_alfa) %>%
mutate(hhd_grassII = case_when(
hhd_elepgrass==100 | hhd_sesbaniya==100 | hhd_alfalfa==100 | hhd_gaya==100 ~ 1,
hhd_elepgrass==0 & hhd_sesbaniya==0 & hhd_alfalfa==0 & hhd_gaya==0 ~ 0
)) %>%
select(household_id:saq01, hhd_grassII) %>%
mutate(wave = "Wave 4") %>%
recode_region(saq01) %>%
left_join(select(track_hh, hh_status), by = "household_id")
wave5_grass <- wave5_hh %>%
select(household_id:saq01, hhd_grass, hhd_grassII) %>%
mutate(wave = "Wave 5") %>%
recode_region(saq01) %>%
left_join(select(track_hh, household_id, hh_status), by = "household_id")
# some cleaning ----
wave4_grass <- wave4_hh %>%
rename(hhd_sesbaniya = hhd_sasbaniya, hhd_alfalfa = hhd_alfa) %>%
mutate(hhd_grassII = case_when(
hhd_elepgrass==100 | hhd_sesbaniya==100 | hhd_alfalfa==100 | hhd_gaya==100 ~ 1,
hhd_elepgrass==0 & hhd_sesbaniya==0 & hhd_alfalfa==0 & hhd_gaya==0 ~ 0
)) %>%
select(household_id:saq01, hhd_grassII) %>%
mutate(wave = "Wave 4") %>%
recode_region(saq01) %>%
left_join(select(track_hh, household_id, hh_status), by = "household_id")
wave5_grass <- wave5_hh %>%
select(household_id:saq01, hhd_grass, hhd_grassII) %>%
mutate(wave = "Wave 5") %>%
recode_region(saq01) %>%
left_join(select(track_hh, household_id, hh_status), by = "household_id")
grass_means <- bind_rows(
mean_tbl(wave4_grass, vars = "hhd_grassII", group_vars = c("wave", "variable"),
pw = pw_w4),
mean_tbl(wave4_grass, vars = "hhd_grassII", group_vars = c("wave", "variable", "region"),
pw = pw_w4),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable"), pw = pw_w5),
mean_tbl(wave5_grass, vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable", "region"), pw = pw_w5)
) %>%
replace_na(list(region = "National"))
wave4_grass
wave4_grass %>% count(hh_status)
grass_means_pnl <- bind_rows(
mean_tbl(filter(wave4_grass, hh_status==3), vars = "hhd_grassII", group_vars = c("wave", "variable"),
pw = pw_w4),
mean_tbl(filter(wave4_grass, hh_status==3), vars = "hhd_grassII", group_vars = c("wave", "variable", "region"),
pw = pw_w4),
mean_tbl(filter(wave5_grass, hh_status==3), vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable"), pw = pw_w5),
mean_tbl(filter(wave5_grass, hh_status==3), vars = c("hhd_grass", "hhd_grassII"),
group_vars = c("wave", "variable", "region"), pw = pw_w5)
) %>%
replace_na(list(region = "National"))
plot_forage <- function(tbl) {
tbl %>%
ggplot(aes(region, mean, fill = wave)) +
geom_col(position = "dodge") +
geom_text(aes(label = paste0( round(mean*100, 1), "%", "\n(", nobs, ")" ) ),
position = position_dodge(width = 1),
vjust = -.35, size = 3) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
# expand_limits(y = maxGrid + .15) +
# facet_wrap(~ level, nrow=2, scales = "free") +
scale_fill_Publication() +
theme_Publication() +
theme(
legend.position = "top",
legend.margin = margin(t = -0.4, unit = "cm"),
axis.title = element_text(size = 12.5),
plot.margin = unit(c(1, 1, 0.5, 1), units = "line") # top, right, bottom, & left
)
}
grass_means %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Forages: ",
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
grass_means %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
plot_forage() +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
grass_means %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Forages: ",
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Forages: ",
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Improved Forages",
subtitle = "Includes only forages measured in the two waves"
fill = "",
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Improved Forages",
subtitle = "Includes only forages measured in the two waves",
fill = "",
caption = "Percent at the household level are weighted sample means.
Number of observations in parenthesis."
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Improved Forages",
fill = "",
caption = "Includes only forages measured in the two waves, i.e., .
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
grass_means_pnl %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
plot_forage() +
labs(
x = "", y = "Percent",
# title = input$var,
fill = "",
caption = "Includes all forages measured in each wave.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes only forages measured in the two waves, i.e., .
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
grass_means_pnl %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes all forages measured in each wave.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
grass_means_pnl %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
plot_forage() +
expand_limits(y = .6) +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes all forages measured in each wave.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes only forages measured in the two waves, i.e., .
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
expand_limits(y = .4) +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes only forages measured in the two waves, i.e., .
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
expand_limits(y = .4) +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes only forages measured in the two waves.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
ggsave(
filename = "../tmp/figures/forages_restricted_pnl.png",
width = 300,
height = 200,
units = "mm"
)
grass_means_pnl %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
plot_forage() +
expand_limits(y = .6) +
labs(
x = "", y = "Percent",
title = "Forage grasses",
fill = "",
caption = "Includes all forages measured in each wave.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
ggsave(
filename = "../tmp/figures/forages_all_pnl.png",
width = 300,
height = 200,
units = "mm"
)
# Panel:
grass_means_pnl %>%
filter(variable == "hhd_grassII",
region != "Tigray") %>%
plot_forage() +
expand_limits(y = .4) +
labs(
x = "", y = "Percent",
title = "Forage grasses",
subtitle = "Panel households",
fill = "",
caption = "Includes only forages measured in the two waves.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
ggsave(
filename = "../tmp/figures/forages_restricted_pnl.png",
width = 300,
height = 200,
units = "mm"
)
grass_means_pnl %>%
filter(
(wave == "Wave 4" & variable == "hhd_grassII") | variable=="hhd_grass",
region != "Tigray"
) %>%
plot_forage() +
expand_limits(y = .6) +
labs(
x = "", y = "Percent",
title = "Forage grasses",
subtitle = "Panel households",
fill = "",
caption = "Includes all forages measured in each wave.
Percent at the household level are weighted sample means. Number of observations in parenthesis."
)
ggsave(
filename = "../tmp/figures/forages_all_pnl.png",
width = 300,
height = 200,
units = "mm"
)
