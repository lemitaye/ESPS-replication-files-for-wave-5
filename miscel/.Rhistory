source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/tab_rep_file.R", echo=TRUE)
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/tab_rep_file.R", echo=TRUE)
main_tab_df
source("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis/cpea_figures.R", echo=TRUE)
w4_dir
adopt_rates_all_hh
adopt_rates_panel_hh
new_innov
w5_hh_new <- wave5_hh_new %>%
select(
household_id, region, pw_w5, all_of(vars_w5)
) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5),
names_to = "variable",
values_to = "value")
main_tab_df
library(tidyverse)
library(kableExtra)
## declare path to export- -----
tabpath <- "C:/Users/l.daba/SPIA Dropbox/Lemi Daba/Apps/Overleaf/README_Eth_report_v2/tables"
# Table as a data frame
main_tab_df <- data.frame(
script = c("09_1_tables_adopt_rates.do"),
datasets = c(""),
int_table = c("09_1_ess5_adoption_rates.xml"),
supp_table = c(""),
report_table = c("")
) %>%
as_tibble()
main_tab_df
# Export table
kbl(
main_tab_df,
format = "latex",
caption = "Put caption here",
booktabs = TRUE,
linesep = "",
align = c("l", "l", "l", "l", "l"),
col.names = c(
"Script", "Data set(s)", "Intermediary table (in scripts)", "Table in supp. material", "Table/Figure in report"
)
) %>%
column_spec(1:5, width = "7em", latex_valign = "b") %>%
kable_styling(latex_options = c("striped", "hold_position")) %>%
save_kable(file.path(tabpath, "rep_tab_main.tex"))
# Table as a data frame
main_tab_df <- data.frame(
script = c("09_1_tables_adopt_rates.do blah blah blah blah blah blah blah"),
datasets = c(""),
int_table = c("09_1_ess5_adoption_rates.xml blah blah blah blah blah blah"),
supp_table = c(""),
report_table = c("")
) %>%
as_tibble()
# Export table
kbl(
main_tab_df,
format = "latex",
caption = "Put caption here",
booktabs = TRUE,
linesep = "",
align = c("l", "l", "l", "l", "l"),
col.names = c(
"Script", "Data set(s)", "Intermediary table (in scripts)", "Table in supp. material", "Table/Figure in report"
)
) %>%
column_spec(1:5, width = "7em", latex_valign = "b") %>%
kable_styling(latex_options = c("striped", "hold_position")) %>%
save_kable(file.path(tabpath, "rep_tab_main.tex"))
# Table as a data frame
main_tab_df <- data.frame(
script = c("09_1_tables_adopt_ rates.do"),
datasets = c(""),
int_table = c("09_1_ess5_adoption_ rates.xml"),
supp_table = c(""),
report_table = c("")
) %>%
as_tibble()
# Export table
kbl(
main_tab_df,
format = "latex",
caption = "Put caption here",
booktabs = TRUE,
linesep = "",
align = c("l", "l", "l", "l", "l"),
col.names = c(
"Script", "Data set(s)", "Intermediary table (in scripts)", "Table in supp. material", "Table/Figure in report"
)
) %>%
column_spec(1:5, width = "7em", latex_valign = "b") %>%
kable_styling(latex_options = c("striped", "hold_position")) %>%
save_kable(file.path(tabpath, "rep_tab_main.tex"))
# Table as a data frame
main_tab_df <- data.frame(
script = c("09_1_tables_adopt _rates.do"),
datasets = c(""),
int_table = c("09_1_ess5_adoption _rates.xml"),
supp_table = c(""),
report_table = c("")
) %>%
as_tibble()
# Export table
kbl(
main_tab_df,
format = "latex",
caption = "Put caption here",
booktabs = TRUE,
linesep = "",
align = c("l", "l", "l", "l", "l"),
col.names = c(
"Script", "Data set(s)", "Intermediary table (in scripts)", "Table in supp. material", "Table/Figure in report"
)
) %>%
column_spec(1:5, width = "7em", latex_valign = "b") %>%
kable_styling(latex_options = c("striped", "hold_position")) %>%
save_kable(file.path(tabpath, "rep_tab_main.tex"))
# variable lists
vars_all_ea <- c(
"ead_ofsp", "ead_awassa83", "ead_kabuli", "ead_rdisp", "ead_motorpump",
"ead_swc", "ead_consag1", "ead_consag2", "ead_affor", "ead_mango",
"ead_papaya", "ead_avocado", "ead_malt", "ead_durum", "ead_hotline",
"ead_seedv1", "ead_seedv2", "ead_livIA", "ead_livIA_publ", "ead_livIA_priv",
"ead_cross_largerum", "ead_cross_smallrum", "ead_cross_poultry",
"ead_agroind", "ead_cowpea", "ead_elepgrass", "ead_deshograss",
"ead_sesbaniya", "ead_sinar", "ead_lablab", "ead_alfalfa", "ead_vetch",
"ead_rhodesgrass", "ead_grass", "commirr", "comm_video", "comm_video_all",
"comm_2wt_own", "comm_2wt_use", "comm_psnp", "ead_mintillage",
"ead_zerotill", "ead_cresidue2", "ead_rotlegume", "ead_psnp"
)
vars_both_ea <- wave4_ea_new %>%
select(any_of(vars_all_ea)) %>%
colnames()
wave4_ea_new <- read_dta("replication_files/3_report_data/wave4_ea_new.dta")
library(haven)
library(tidyverse)
# library(thatssorandom)
library(labelled)
library(janitor)
library(kableExtra)
library(scales)
# theme_set(theme_light())
setwd("C:/Users/l.daba/OneDrive/SPIA/Ethiopia")
wave4_ea_new <- read_dta("replication_files/3_report_data/wave4_ea_new.dta")
wave5_ea_new <- read_dta("LSMS_W5/3_report_data/wave5_ea_new.dta")
ess4_ea_psnp <- read_dta("replication_files/3_report_data/ess4_ea_psnp.dta") %>%
select(ea_id, ead_psnp, sh_ea_psnp)
wave4_ea_new <- wave4_ea_new %>%
mutate(ead_grass = case_when(
ead_elepgrass==100 | ead_sasbaniya==100 | ead_alfa==100 ~ 1,
ead_elepgrass==0 & ead_sasbaniya==0 & ead_alfa==0 ~ 0
)) %>%
left_join(ess4_ea_psnp, by = "ea_id")
wave5_ea_new <- wave5_ea_new %>%
mutate(ead_grass = case_when(
ead_elepgrass==1 | ead_sesbaniya==1 | ead_alfalfa==1 ~ 1,
ead_elepgrass==0 & ead_sesbaniya==0 & ead_alfalfa==0 ~ 0
))
recode_region <- function(tbl) {
tbl %>%
mutate(
region = recode(region,
`0` = "Other regions",
`1` = "Tigray",
`3` = "Amhara",
`4` = "Oromia",
`7` = "SNNP")
)
}
# variable lists
vars_all_ea <- c(
"ead_ofsp", "ead_awassa83", "ead_kabuli", "ead_rdisp", "ead_motorpump",
"ead_swc", "ead_consag1", "ead_consag2", "ead_affor", "ead_mango",
"ead_papaya", "ead_avocado", "ead_malt", "ead_durum", "ead_hotline",
"ead_seedv1", "ead_seedv2", "ead_livIA", "ead_livIA_publ", "ead_livIA_priv",
"ead_cross_largerum", "ead_cross_smallrum", "ead_cross_poultry",
"ead_agroind", "ead_cowpea", "ead_elepgrass", "ead_deshograss",
"ead_sesbaniya", "ead_sinar", "ead_lablab", "ead_alfalfa", "ead_vetch",
"ead_rhodesgrass", "ead_grass", "commirr", "comm_video", "comm_video_all",
"comm_2wt_own", "comm_2wt_use", "comm_psnp", "ead_mintillage",
"ead_zerotill", "ead_cresidue2", "ead_rotlegume", "ead_psnp"
)
vars_both_ea <- wave4_ea_new %>%
select(any_of(vars_all_ea)) %>%
colnames()
vars_w5_ea <- setdiff(vars_all_ea, vars_both_ea) # vars only in wave 5
vars_w5_ea
# load packages ----
library(haven)
library(tidyverse)
library(labelled)
# load data ----
wave5_hh <- read_dta("../3_report_data/wave5_hh_new.dta")
setwd("C:/Users/l.daba/SPIA Dropbox/SPIA General/5. OBJ.3 - Data collection/Country teams/Ethiopia/LSMS_W5/5_analysis")
wave5_hh <- read_dta("../3_report_data/wave5_hh_new.dta")
vars_w5 <- c(
"hhd_kabuli", "hhd_desi", "hotline", "hhd_malt", "hhd_durum", "hhd_seedv1",
"hhd_seedv2", "hhd_livIA_publ", "hhd_livIA_priv", "hhd_deshograss", "hhd_sinar",
"hhd_lablab", "hhd_vetch", "hhd_rhodesgrass"
)
w5_hh_new <- wave5_hh_new %>%
select(
household_id, region, pw_w5, all_of(vars_w5)
) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5),
names_to = "variable",
values_to = "value")
w5_hh_new <- read_dta("../3_report_data/wave5_hh_new.dta")
vars_w5 <- c(
"hhd_kabuli", "hhd_desi", "hotline", "hhd_malt", "hhd_durum", "hhd_seedv1",
"hhd_seedv2", "hhd_livIA_publ", "hhd_livIA_priv", "hhd_deshograss", "hhd_sinar",
"hhd_lablab", "hhd_vetch", "hhd_rhodesgrass"
)
w5_hh_new <- wave5_hh_new %>%
select(
household_id, region, pw_w5, all_of(vars_w5)
) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5),
names_to = "variable",
values_to = "value")
wave5_hh_new <- read_dta("../3_report_data/wave5_hh_new.dta")
vars_w5 <- c(
"hhd_kabuli", "hhd_desi", "hotline", "hhd_malt", "hhd_durum", "hhd_seedv1",
"hhd_seedv2", "hhd_livIA_publ", "hhd_livIA_priv", "hhd_deshograss", "hhd_sinar",
"hhd_lablab", "hhd_vetch", "hhd_rhodesgrass"
)
w5_hh_new <- wave5_hh_new %>%
select(
household_id, region, pw_w5, all_of(vars_w5)
) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5),
names_to = "variable",
values_to = "value")
recode_region
wave5_hh_new
wave5_hh_new %>% count(regio)
wave5_hh_new %>% count(region)
w5_hh_new
# vector of new innovations
vars_w5 <- c(
"hhd_kabuli", "hhd_desi", "hotline", "hhd_malt", "hhd_durum", "hhd_seedv1",
"hhd_seedv2", "hhd_livIA_publ", "hhd_livIA_priv", "hhd_deshograss", "hhd_sinar",
"hhd_lablab", "hhd_vetch", "hhd_rhodesgrass"
)
# functions ----
recode_region <- function(tbl) {
suppressWarnings(
tbl %>%
mutate(
region = recode(
region,
`1` = "Tigray",
`3` = "Amhara",
`4` = "Oromia",
`7` = "SNNP",
`0` = "Other regions"
)
)
)
}
w5_hh_new <- wave5_hh_new %>%
select(
household_id, region, pw_w5, all_of(vars_w5)
) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5),
names_to = "variable",
values_to = "value")
w5_hh_new
w5_hh_new %>% count(region)
w5_means_new <- left_join(
x = bind_rows(
w5_hh_new %>%
group_by(region, variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
),
w5_hh_new %>%
group_by(variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
) %>%
mutate(region = "National")
),
y = var_label(select(wave5_hh_new, all_of(vars_w5))) %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
),
by = "variable"
)
w5_means_new
new_innov <- w5_means_new %>%
filter(variable != "hhd_kabuli",
!str_detect(label, "Feed and Forage")) %>%
mutate(region = fct_relevel(region, "Amhara", "Oromia", "SNNP", "Other regions", "National")) %>%
ggplot(aes(region, mean, fill = region)) +
geom_col() +
geom_text(aes(label = paste0(round(mean*100, 2), " %")),
vjust = -.5, size = 2.5) +
facet_wrap(~ label, scales = "free", nrow = 4) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
theme(legend.position = "none") +
labs(y = "Percent of households adopting",
x = "",
title = "Adoption of innovations incorporated only in ESPS5")
new_innov
wave5_ea_new <- read_dta("../3_report_data/wave5_ea_new.dta")
wave5_ea_new
wave5_ea_new <- read_dta("../3_report_data/wave5_ea_new.dta")
vars_w5_ea <- c(
"ead_kabuli", "ead_malt", "ead_durum", "ead_hotline", "ead_seedv1", "ead_seedv2",
"ead_livIA_publ", "ead_livIA_priv", "ead_deshograss", "ead_sinar", "ead_lablab",
"ead_vetch", "ead_rhodesgrass", "comm_video", "comm_video_all", "comm_2wt_own",
"comm_2wt_use"
)
w5_ea_new <- wave5_ea_new %>%
select(ea_id, wave, region, pw = pw_w5, all_of(vars_w5_ea)) %>%
recode_region()
w5_ea_new
w5_ea_new %>% glimpse()
w5_means_new_ea <- left_join(
x = bind_rows(
w5_ea_new %>%
group_by(region, variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
),
w5_ea_new %>%
group_by(variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
) %>%
mutate(region = "National")
),
y = var_label(select(w5_ea_new, all_of(vars_w5_ea))) %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
),
by = "variable"
)
w5_ea_new <- wave5_ea_new %>%
select(ea_id, wave, region, pw = pw_w5, all_of(vars_w5_ea)) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5_ea),
names_to = "variable",
values_to = "value")
w5_ea_new
w5_means_new_ea <- left_join(
x = bind_rows(
w5_ea_new %>%
group_by(region, variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
),
w5_ea_new %>%
group_by(variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
) %>%
mutate(region = "National")
),
y = var_label(select(w5_ea_new, all_of(vars_w5_ea))) %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
),
by = "variable"
)
w5_ea_new <- wave5_ea_new %>%
select(ea_id, wave, region, pw_w5, all_of(vars_w5_ea)) %>%
recode_region() %>%
pivot_longer(all_of(vars_w5_ea),
names_to = "variable",
values_to = "value")
w5_means_new_ea <- left_join(
x = bind_rows(
w5_ea_new %>%
group_by(region, variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
),
w5_ea_new %>%
group_by(variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
) %>%
mutate(region = "National")
),
y = var_label(select(w5_ea_new, all_of(vars_w5_ea))) %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
),
by = "variable"
)
bind_rows(
w5_ea_new %>%
group_by(region, variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
),
w5_ea_new %>%
group_by(variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
) %>%
mutate(region = "National")
)
w5_means_ea <- bind_rows(
w5_ea_new %>%
group_by(region, variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
),
w5_ea_new %>%
group_by(variable) %>%
summarise(
mean = weighted.mean(value, w = pw_w5, na.rm = TRUE),
nobs = sum(!is.na(value)),
.groups = "drop"
) %>%
mutate(region = "National")
)
w5_means_ea
var_label(select(w5_ea_new, all_of(vars_w5_ea)))
var_label(select(wave5_ea_new, all_of(vars_w5_ea)))
var_labs_ea <- var_label(select(wave5_ea_new, all_of(vars_w5_ea))) %>%
as_tibble() %>%
pivot_longer(
cols = everything(),
names_to = "variable",
values_to = "label"
)
var_labs_ea
w5_means_new_ea <- left_join(
x = w5_means_ea,
y = var_labs_ea,
by = "variable"
)
w5_means_new_ea
w5_means_new_ea %>% count(variable)
# Figure
new_innov_ea <- w5_means_new_ea %>%
filter(variable != "ead_kabuli",
!str_detect(label, "Feed and Forage")) %>%
mutate(region = fct_relevel(region, "Amhara", "Oromia", "SNNP", "Other regions", "National")) %>%
ggplot(aes(region, mean, fill = region)) +
geom_col() +
geom_text(aes(label = paste0(round(mean*100, 2), " %")),
vjust = -.5, size = 2.5) +
facet_wrap(~ label, scales = "free", nrow = 4) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
theme(legend.position = "none") +
labs(y = "Percent of households adopting",
x = "",
title = "Adoption of innovations incorporated only in ESPS5")
new_innov_ea
# Figure
new_innov_ea <- w5_means_new_ea %>%
filter(variable != "ead_kabuli",
!str_detect(label, "Feed and Forage")) %>%
mutate(region = fct_relevel(region, "Amhara", "Oromia", "SNNP", "Other regions", "National")) %>%
ggplot(aes(region, mean, fill = region)) +
geom_col() +
geom_text(aes(label = paste0(round(mean*100, 2), " %")),
vjust = -.5, size = 2.5) +
facet_wrap(~ label, scales = "free", nrow = 4) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
scale_y_continuous(labels = percent_format()) +
theme(legend.position = "none") +
labs(y = "Percent of EAs with at least 1 hh adopting",
x = "",
title = "Adoption of innovations incorporated only in ESPS5")
new_innov_ea
